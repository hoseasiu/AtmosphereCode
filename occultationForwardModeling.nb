(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    167241,       3890]
NotebookOptionsPosition[    163918,       3771]
NotebookOutlinePosition[    164264,       3786]
CellTagsIndexPosition[    164221,       3783]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[TextData[{
 "Occultation Forward Modeling Notebook\n",
 StyleBox["Hosea Siu", "Subtitle"]
}], "Title",
 CellChangeTimes->{{3.630257455020686*^9, 3.6302575201940064`*^9}}],

Cell[CellGroupData[{

Cell["Constant Declarations", "Section",
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.630256888582099*^9, 3.630256894443264*^9}, {
  3.630256994052059*^9, 3.6302570896239877`*^9}, {3.630265518564429*^9, 
  3.630265526623148*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"{", 
    RowBox[{
    "TOL", ",", "NAvagadro", ",", "R", ",", "k", ",", "G", ",", "\[Alpha]N2", 
     ",", "MN2", ",", "MPluto", ",", "rPluto", ",", "distToObserver"}], "}"}],
    "=", 
   RowBox[{"ToExpression", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{
      "\"\</Users/Hosea/Dropbox \
(MIT)//Academic/12.ThG/AtmosphereCode/constants.xlsx\>\"", ",", 
       RowBox[{"{", 
        RowBox[{"\"\<Data\>\"", ",", "1"}], "}"}]}], "]"}], "[", 
     RowBox[{"[", 
      RowBox[{";;", ",", "2"}], "]"}], "]"}], "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.630257091078019*^9, 3.630257091079023*^9}, {
  3.630257169875024*^9, 3.6302572042064247`*^9}, {3.6302580707563095`*^9, 
  3.6302581031813526`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["General Helper Functions", "Section",
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.6302577302092724`*^9, 3.6302577554272013`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "local", " ", "gravity", " ", "as", " ", "a", " ", "function", " ", "of", 
    " ", "r", " ", "and", " ", "M"}], "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"gravity", "[", 
      RowBox[{"r_", ",", " ", "MPlanet_"}], "]"}], " ", ":=", " ", 
     RowBox[{"G", "*", 
      RowBox[{"MPlanet", "/", 
       RowBox[{"r", "^", "2"}]}]}]}], ";"}], "\n", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{"barometric", " ", "formula"}], " ", "-", " ", 
     RowBox[{
     "pressure", " ", "as", " ", "a", " ", "function", " ", "of", " ", 
      "height", " ", "for", " ", "isothermal", " ", "atmospheres", " ", 
      "only"}]}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"barometric", "[", 
      RowBox[{
      "p0_", ",", " ", "M_", ",", " ", "h_", ",", " ", "T_", ",", " ", "r0_", 
       ",", " ", "MPlanet_"}], "]"}], " ", ":=", " ", 
     RowBox[{"p0", " ", 
      RowBox[{"E", "^", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"-", "M"}], " ", 
           RowBox[{"gravity", "[", 
            RowBox[{
             RowBox[{"h", " ", "+", " ", "r0"}], ",", " ", "MPlanet"}], "]"}],
            " ", "h"}], ")"}], "/", 
         RowBox[{"(", 
          RowBox[{"R", " ", "T"}], ")"}]}], ")"}]}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"slopeInterceptFrom2Pts", "[", 
      RowBox[{"x1_", ",", "y1_", ",", "x2_", ",", "y2_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"m", ",", "b"}], "}"}], ",", 
       RowBox[{
        RowBox[{"m", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"y1", "-", "y2"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"x1", "-", "x2"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"b", "=", 
         RowBox[{"y1", "-", 
          RowBox[{"m", " ", "x1"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"{", 
          RowBox[{"m", ",", "b"}], "}"}], "]"}], ";"}]}], "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.63025775657804*^9, 3.6302578263366194`*^9}, {
   3.6302594112378287`*^9, 3.6302594231843033`*^9}, 3.6302599416748104`*^9, {
   3.630269045385474*^9, 3.6302691052890444`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Atmosphere Construction Functions", "Section",
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.630257612866873*^9, 3.6302576244090757`*^9}, {
  3.6302598143633413`*^9, 3.630259845538508*^9}}],

Cell[CellGroupData[{

Cell["Physical Equations", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.630265200663472*^9, 3.6302652042630434`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"Lorentz", "-", 
     RowBox[{
     "Lorenz", " ", "Equation", " ", "for", " ", "n", " ", "values", " ", 
      "close", " ", "to", " ", "1"}]}], ":", 
    RowBox[{
    "returns", " ", "a", " ", "refractive", " ", "index", " ", "n", " ", 
     "given", " ", "a", " ", "temperature", " ", "and", " ", "pressure"}]}], 
   "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"TODO", "-", " ", 
     RowBox[{"this", " ", 
      RowBox[{"won", "'"}], "t", " ", "actually", " ", "work", " ", "for", 
      " ", "now"}]}], ",", " ", 
    RowBox[{
    "but", " ", "use", " ", "it", " ", "as", " ", "a", " ", "placeholder"}]}],
    "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"lorentzLorenz", "[", 
      RowBox[{"\[Alpha]_", ",", "p_", ",", "T_"}], "]"}], ":=", 
     RowBox[{"SetPrecision", "[", 
      RowBox[{
       RowBox[{"\[Sqrt]", 
        RowBox[{"(", 
         RowBox[{"1", "+", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
            "4", " ", "\[Pi]", " ", "NAvagadro", " ", "\[Alpha]", " ", "p"}], 
            ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"R", " ", "T"}], ")"}]}]}], ")"}]}], ",", "100"}], 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"exact", " ", "version", " ", "of", " ", "LL", " ", "equation"}], 
    " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"lorentzLorenzExact", "[", 
      RowBox[{"\[Alpha]_", ",", "p_", ",", "T_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"n", ",", "sols"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"sols", " ", "=", " ", 
         RowBox[{"NSolve", "[", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["n", "2"], "-", "1"}], ")"}], "/", 
             RowBox[{"(", 
              RowBox[{
               SuperscriptBox["n", "2"], "+", "2"}], ")"}]}], "\[Equal]", " ", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"4", " ", "\[Pi]", " ", "p", " ", "\[Alpha]"}], ")"}], 
             "/", 
             RowBox[{"(", 
              RowBox[{"3", " ", "R", " ", "T"}], ")"}]}]}], ",", "n"}], 
          "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", 
         RowBox[{"First", "[", 
          RowBox[{"Select", "[", 
           RowBox[{
            RowBox[{"n", "/.", "sols"}], ",", 
            RowBox[{
             RowBox[{"#", "\[GreaterEqual]", " ", "0"}], "&"}]}], "]"}], 
          "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.630265205502939*^9, 3.6302652362177563`*^9}, {
  3.6302654956501284`*^9, 3.6302655075645943`*^9}, {3.630266506704723*^9, 
  3.6302665073802123`*^9}, {3.63026915203527*^9, 3.630269171461094*^9}, {
  3.630427007219858*^9, 3.6304270182236557`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Helper Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6302652548259706`*^9, 3.6302652585886707`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"setAtmProperty", "[", 
     RowBox[{"startValue_", ",", "stopValue_", ",", "numShells_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"startValue", "\[Equal]", "stopValue"}], ",", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"no", " ", "variation"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"startValue", ",", "numShells"}], "]"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"linear", " ", "variation"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"Range", "[", 
         RowBox[{"startValue", ",", "stopValue", ",", 
          RowBox[{"N", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"stopValue", "-", "startValue"}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"numShells", "-", "1"}], ")"}]}], "]"}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeAtmosphereSection", "[", 
     RowBox[{
     "r0_", ",", "r1_", ",", "MPlanet_", ",", "sectionShells_", ",", "T0_", 
      ",", "T1_", ",", "M0_", ",", "M1_", ",", "P0_", ",", "\[Alpha]z0_", ",",
       "\[Alpha]z1_", ",", "\[Alpha]0_", ",", "\[Alpha]1_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "radii", ",", "temps", ",", "M", ",", "pressures", ",", "\[Rho]n", ",",
         "dP", ",", "mM", ",", "bM", ",", "mT", ",", "bT", ",", "P", ",", "r",
         ",", "i", ",", "\[Alpha]z", ",", "\[Alpha]", ",", 
        "\[ScriptCapitalN]"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"mM", ",", "bM"}], "}"}], "=", 
        RowBox[{"slopeInterceptFrom2Pts", "[", 
         RowBox[{"r0", ",", "M0", ",", "r1", ",", "M1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"mT", ",", "bT"}], "}"}], "=", 
        RowBox[{"slopeInterceptFrom2Pts", "[", 
         RowBox[{"r0", ",", "T0", ",", "r1", ",", "T1"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"radii", "=", 
        RowBox[{"setAtmProperty", "[", 
         RowBox[{"r0", ",", "r1", ",", 
          RowBox[{"Round", "[", "sectionShells", "]"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", " ", 
        RowBox[{
        "rounding", " ", "in", " ", "case", " ", "sectionShells", " ", "is", 
         " ", "not", " ", "passed", " ", "in", " ", "as", " ", "an", " ", 
         "integer"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"M", "=", 
        RowBox[{"setAtmProperty", "[", 
         RowBox[{"M0", ",", "M1", ",", 
          RowBox[{"Round", "[", "sectionShells", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"temps", "=", 
        RowBox[{"setAtmProperty", "[", 
         RowBox[{"T0", ",", "T1", ",", 
          RowBox[{"Round", "[", "sectionShells", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Alpha]z", "=", 
        RowBox[{"setAtmProperty", "[", 
         RowBox[{"\[Alpha]z0", ",", "\[Alpha]z1", ",", 
          RowBox[{"Round", "[", "sectionShells", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"\[Alpha]", "=", 
        RowBox[{"setAtmProperty", "[", 
         RowBox[{"\[Alpha]0", ",", "\[Alpha]1", ",", 
          RowBox[{"Round", "[", "sectionShells", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"pressures", "=", 
        RowBox[{"{", "P0", "}"}]}], ";", 
       RowBox[{"\[Rho]n", "=", 
        RowBox[{"{", 
         FractionBox["P0", 
          RowBox[{"k", " ", 
           RowBox[{
           "temps", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}]],
          "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dP", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
          "\[Rho]n", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
          " ", 
          RowBox[{
          "M", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[ScriptCapitalN]", "=", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"lorentzLorenzExact", "[", 
           RowBox[{
            RowBox[{"\[Alpha]", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"pressures", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", 
            RowBox[{"temps", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "-", "1"}], "}"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"pressures", ",", 
            RowBox[{"Re", "[", 
             RowBox[{"DSolveValue", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   SuperscriptBox["P", "\[Prime]",
                    MultilineFunction->None], "[", "r", "]"}], "\[Equal]", 
                  RowBox[{"-", 
                   FractionBox[
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"mM", " ", "r"}], "+", "bM"}], ")"}], " ", 
                    RowBox[{"P", "[", "r", "]"}], " ", 
                    RowBox[{"(", 
                    RowBox[{"G", " ", "MPlanet"}], ")"}]}], 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"mT", " ", "r"}], "+", "bT"}], ")"}], " ", "R", 
                    " ", 
                    SuperscriptBox["r", "2"]}]]}]}], ",", 
                 RowBox[{
                  RowBox[{"P", "[", "r0", "]"}], "\[Equal]", "P0"}]}], "}"}], 
               ",", 
               RowBox[{"P", "[", 
                RowBox[{
                "radii", "\[LeftDoubleBracket]", "i", 
                 "\[RightDoubleBracket]"}], "]"}], ",", "r"}], "]"}], "]"}]}],
            "]"}], ";", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"\[Rho]n", ",", 
            FractionBox[
             RowBox[{
             "pressures", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}], 
             RowBox[{"k", " ", 
              RowBox[{
              "temps", "\[LeftDoubleBracket]", "i", 
               "\[RightDoubleBracket]"}]}]]}], "]"}], ";", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"dP", ",", 
            RowBox[{
             RowBox[{
             "\[Rho]n", "\[LeftDoubleBracket]", "i", 
              "\[RightDoubleBracket]"}], " ", 
             RowBox[{
             "M", "\[LeftDoubleBracket]", "i", "\[RightDoubleBracket]"}]}]}], 
           "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"\[ScriptCapitalN]", ",", 
            RowBox[{
             RowBox[{"lorentzLorenzExact", "[", 
              RowBox[{
               RowBox[{"\[Alpha]", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"pressures", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"temps", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "-", "1"}]}], "]"}], 
          ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "2", ",", 
           RowBox[{"Length", "[", "radii", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
         "radii", ",", "temps", ",", "M", ",", "pressures", ",", "\[Rho]n", 
          ",", "\[Alpha]z", ",", "\[Alpha]", ",", "\[ScriptCapitalN]"}], 
         "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"joinAtmosphereSections", "[", "sections_", "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "radii", ",", "temps", ",", "M", ",", "pressures", ",", "\[Rho]n", ",", 
       "\[Alpha]z", ",", "\[Alpha]", ",", "\[ScriptCapitalN]", ",", 
       "currentSection"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"radii", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"temps", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"M", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"pressures", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Rho]n", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Alpha]z", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Alpha]", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[ScriptCapitalN]", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"currentSection", "=", 
          RowBox[{"sections", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"i", "\[NotEqual]", " ", "1"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Print", "[", "\"\<dropping a base shell\>\"", "]"}], ";",
             "\[IndentingNewLine]", 
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"currentSection", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "=", 
                RowBox[{"Drop", "[", 
                 RowBox[{
                  RowBox[{"currentSection", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "1"}], "]"}]}], ";"}],
               ",", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{
                "if", " ", "the", " ", "current", " ", "section", " ", "that",
                  " ", 
                 RowBox[{"we", "'"}], "re", " ", "looking", " ", "at", " ", 
                 RowBox[{"isn", "'"}], "t", " ", "the", " ", "bottome", " ", 
                 "section"}], ",", " ", 
                RowBox[{"drop", " ", "the", " ", "bottommost", " ", "shell"}],
                 ",", " ", 
                RowBox[{"because", " ", 
                 RowBox[{"it", "'"}], "s", " ", "a", " ", "duplicate", " ", 
                 "of", " ", "the", " ", "one", " ", "below", " ", "it"}]}], 
               " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "currentSection", "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"radii", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"radii", ",", 
            RowBox[{
            "currentSection", "\[LeftDoubleBracket]", "1", 
             "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
         RowBox[{"temps", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"temps", ",", 
            RowBox[{
            "currentSection", "\[LeftDoubleBracket]", "2", 
             "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
         RowBox[{"M", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"M", ",", 
            RowBox[{
            "currentSection", "\[LeftDoubleBracket]", "3", 
             "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
         RowBox[{"pressures", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"pressures", ",", 
            RowBox[{
            "currentSection", "\[LeftDoubleBracket]", "4", 
             "\[RightDoubleBracket]"}]}], "]"}]}], ";", 
         RowBox[{"\[Rho]n", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"\[Rho]n", ",", 
            RowBox[{
            "currentSection", "\[LeftDoubleBracket]", "5", 
             "\[RightDoubleBracket]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"\[Alpha]z", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"\[Alpha]z", ",", 
            RowBox[{"currentSection", "[", 
             RowBox[{"[", "6", "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[Alpha]", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"\[Alpha]", ",", 
            RowBox[{"currentSection", "[", 
             RowBox[{"[", "7", "]"}], "]"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"\[ScriptCapitalN]", "=", 
          RowBox[{"Join", "[", 
           RowBox[{"\[ScriptCapitalN]", ",", 
            RowBox[{"currentSection", "[", 
             RowBox[{"[", "8", "]"}], "]"}]}], "]"}]}], ";"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "sections", "]"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{
        "radii", ",", "temps", ",", "M", ",", "pressures", ",", "\[Rho]n", 
         ",", "\[Alpha]z", ",", "\[Alpha]", ",", "\[ScriptCapitalN]"}], "}"}],
        "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.630265286507482*^9, 3.6302652868087215`*^9}, {
   3.630265916978608*^9, 3.6302659920489597`*^9}, {3.6302661126766844`*^9, 
   3.630266151373199*^9}, {3.630266191376631*^9, 3.6302662304313593`*^9}, {
   3.630267472595653*^9, 3.630267672074445*^9}, {3.6302690997421026`*^9, 
   3.6302691024039936`*^9}, {3.630269145472623*^9, 3.630269148530778*^9}, {
   3.6302691842331543`*^9, 3.630269236440259*^9}, {3.630343388511955*^9, 
   3.630343490776765*^9}, 3.63034432736473*^9, {3.630427031711216*^9, 
   3.6304270409397774`*^9}, {3.63043119948145*^9, 3.630431262092836*^9}, {
   3.6304315459580603`*^9, 3.6304316038440757`*^9}, {3.630431725156065*^9, 
   3.630431753583215*^9}, {3.6304317947504025`*^9, 3.6304318007346373`*^9}, {
   3.630431843519972*^9, 3.6304319033703876`*^9}, 3.6304319382881556`*^9, {
   3.630431992766759*^9, 3.6304319983397055`*^9}, 3.6304320712694006`*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Atomsphere Generation Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6302653032453856`*^9, 3.6302653240081444`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"makeAtmosphere", "[", 
     RowBox[{
     "boundaryR_", ",", "boundaryT_", ",", "boundaryM_", ",", 
      "sectionShells_", ",", "P0_", ",", "boundary\[Alpha]z_", ",", 
      "boundary\[Alpha]_", ",", "MPlanet_", ",", 
      RowBox[{"exportFolderPath_:", " ", "Null"}], ",", 
      RowBox[{"atmosphereNumber_:", " ", "Null"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "numSections", ",", "atmSections", ",", "section", ",", "PRef", ",", 
        "atmosphere", ",", "header", ",", "fullPath"}], "}"}], ",", 
      RowBox[{
       RowBox[{"numSections", "=", 
        RowBox[{"Length", "[", "sectionShells", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"atmSections", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"PRef", "=", "P0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Length", "[", "boundaryR", "]"}], "\[NotEqual]", 
           RowBox[{"numSections", "+", "1"}]}], "||", 
          RowBox[{
           RowBox[{"Length", "[", "boundaryT", "]"}], "\[NotEqual]", 
           RowBox[{"numSections", "+", "1"}]}], "||", 
          RowBox[{
           RowBox[{"Length", "[", "boundaryM", "]"}], "\[NotEqual]", 
           RowBox[{"numSections", "+", "1"}]}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
          "Print", "[", 
           "\"\<invalid number of arguments in MakeAtmosphere\>\"", "]"}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"Return", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"section", "=", 
           RowBox[{"makeAtmosphereSection", "[", 
            RowBox[{
             RowBox[{"boundaryR", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"boundaryR", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "MPlanet", ",", 
             RowBox[{"sectionShells", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"boundaryT", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"boundaryT", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
             RowBox[{"boundaryM", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"boundaryM", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", "PRef", ",", 
             RowBox[{"boundary\[Alpha]z", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"boundary\[Alpha]z", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", 
             RowBox[{"boundary\[Alpha]", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"boundary\[Alpha]", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PRef", "=", 
           RowBox[{"Last", "[", 
            RowBox[{"section", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"atmSections", ",", "section"}], "]"}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", "numSections"}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"atmosphere", "=", 
        RowBox[{"joinAtmosphereSections", "[", "atmSections", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"header", "=", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
          "boundaryR", ",", "boundaryT", ",", "boundaryM", ",", 
           "sectionShells", ",", "P0", ",", "boundary\[Alpha]z", ",", 
           "boundary\[Alpha]", ",", "MPlanet"}], "}"}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"StringQ", "[", "exportFolderPath", "]"}], ",", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"IntegerQ", "[", "atmosphereNumber", "]"}], ",", 
            RowBox[{
             RowBox[{"fullPath", "=", 
              RowBox[{
              "exportFolderPath", "<>", "\"\</constructedAtmosphere\>\"", "<>", 
               RowBox[{"IntegerString", "[", "atmosphereNumber", "]"}], "<>", 
               "\"\<.tsv\>\""}]}], ";"}], ",", 
            RowBox[{
             RowBox[{"fullPath", "=", 
              RowBox[{
              "exportFolderPath", "<>", "\"\</constructedAtmosphere\>\"", 
               "<>", "\"\<.tsv\>\""}]}], ";"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"Export", "[", 
           RowBox[{"fullPath", ",", 
            RowBox[{"Join", "[", 
             RowBox[{"header", ",", 
              RowBox[{"atmosphere", "\[Transpose]"}]}], "]"}], ",", 
            "\"\<Table\>\""}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"Print", "[", 
           RowBox[{"\"\<exported atmosphere to \>\"", "<>", "fullPath"}], 
           "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "atmosphere", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"same", " ", "as", " ", "version", " ", "above"}], ",", 
    RowBox[{
    "but", " ", "allows", " ", "all", " ", "parameters", " ", "to", " ", "be",
      " ", "passed", " ", "in", " ", "via", " ", "a", " ", "single", " ", 
     "list", " ", 
     RowBox[{"(", 
      RowBox[{"of", " ", "lists", " ", "and", " ", "numbers"}], ")"}]}]}], 
   "*)"}], 
  RowBox[{"(*", 
   RowBox[{
   "allows", " ", "for", " ", "easier", " ", "editing", " ", "of", " ", 
    "parameters", " ", "when", " ", "making", " ", "a", " ", "range", " ", 
    "of", " ", "atmospheres"}], "*)"}], 
  RowBox[{
   RowBox[{
    RowBox[{"makeAtmosphere", "[", 
     RowBox[{"params_", ",", 
      RowBox[{"exportFolderPath_:", " ", "Null"}], ",", 
      RowBox[{"atmosphereNumber_:", " ", "Null"}]}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "}"}], ",", 
      RowBox[{
       RowBox[{"Return", "[", 
        RowBox[{
         RowBox[{"makeAtmosphere", "[", 
          RowBox[{
           RowBox[{"params", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "3", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "4", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "5", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "6", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "7", "]"}], "]"}], ",", 
           RowBox[{"params", "[", 
            RowBox[{"[", "8", "]"}], "]"}], ",", "exportFolderPath", ",", 
           "atmosphereNumber"}], "]"}], ";"}], "]"}], ";"}]}], "]"}]}], ";"}],
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
   "make", " ", "a", " ", "set", " ", "of", " ", "atmospheres", " ", "based", 
    " ", "on", " ", "one", " ", "variable", " ", "property"}], " ", 
   "*)"}]}], "\n", 
 RowBox[{
  RowBox[{
   RowBox[{"makeAtmosphereSet", "[", 
    RowBox[{
    "baseAtm_", ",", "exportFolderPath_", ",", "variableProperty_", ",", 
     RowBox[{"initNum_:", " ", "1"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "atmNum", ",", "varRange", ",", "currentAtm", ",", "arrayPosition", ",",
        "propertyNum", ",", "prop", ",", "error"}], "}"}], ",", 
     RowBox[{
      RowBox[{"error", "=", "False"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"check", " ", "for", " ", "specification", " ", "problems"}], 
       "*)"}], 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "variableProperty", "]"}], "\[NotEqual]", 
          "5"}], "||", 
         RowBox[{"!", 
          RowBox[{"StringQ", "[", 
           RowBox[{"variableProperty", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{
         "Print", "[", 
          "\"\<variableProperty specification length or property error\>\"", 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"error", "=", "True"}], ";"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"error", ",", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{"(*", 
        RowBox[{
        "make", " ", "sure", " ", "all", " ", "specs", " ", "are", " ", 
         "positive"}], "*)"}], 
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"variableProperty", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "\[LessEqual]", "0"}], ",", 
          RowBox[{
           RowBox[{
           "Print", "[", 
            "\"\<zero or negative value in variableProperty \
specification\>\"", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"error", "=", "True"}], ";"}]}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "variableProperty", "]"}]}], "}"}]}], "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"error", ",", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"atmNum", "=", "initNum"}], ";", "\[IndentingNewLine]", 
      RowBox[{"varRange", "=", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"variableProperty", "[", 
          RowBox[{"[", "3", "]"}], "]"}], ",", 
         RowBox[{"variableProperty", "[", 
          RowBox[{"[", "4", "]"}], "]"}], ",", 
         RowBox[{"variableProperty", "[", 
          RowBox[{"[", "5", "]"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"arrayPosition", "=", 
       RowBox[{"variableProperty", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"prop", "=", 
       RowBox[{"ToLowerCase", "[", 
        RowBox[{"variableProperty", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", 
       RowBox[{"(*", 
        RowBox[{
        "figure", " ", "out", " ", "which", " ", "property", " ", "we", " ", 
         "want", " ", "to", " ", "change"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"prop", "\[Equal]", "\"\<r\>\""}], ",", 
        RowBox[{"propertyNum", "=", "1"}], ",", "\[IndentingNewLine]", 
        RowBox[{"prop", "\[Equal]", "\"\<t\>\""}], ",", 
        RowBox[{"propertyNum", "=", "2"}], ",", "\[IndentingNewLine]", 
        RowBox[{"prop", "\[Equal]", "\"\<m\>\""}], ",", 
        RowBox[{"propertyNum", "=", "3"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"prop", "\[Equal]", "\"\<s\>\""}], "||", 
         RowBox[{"prop", "\[Equal]", "\"\<shells\>\""}], "||", 
         RowBox[{"prop", "\[Equal]", "\"\<sectionshells\>\""}]}], ",", 
        RowBox[{"propertyNum", "=", "4"}], ",", "\[IndentingNewLine]", 
        RowBox[{"prop", "\[Equal]", "\"\<p0\>\""}], ",", 
        RowBox[{"propertyNum", "=", "5"}], ",", "\[IndentingNewLine]", 
        RowBox[{"prop", "\[Equal]", "\"\<\[Alpha]z\>\""}], ",", 
        RowBox[{"propertyNum", "=", "6"}], ",", "\[IndentingNewLine]", 
        RowBox[{"prop", "\[Equal]", " ", "\"\<\[Alpha]\>\""}], ",", " ", 
        RowBox[{"propertyNum", " ", "=", " ", "7"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"prop", "\[Equal]", "\"\<mplanet\>\""}], ",", 
        RowBox[{"propertyNum", "=", "8"}], ",", "\[IndentingNewLine]", "True",
         ",", 
        RowBox[{
         RowBox[{"Print", "[", "\"\<property request error\>\"", "]"}], ";", 
         RowBox[{"Return", "[", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"check", " ", "constraints", " ", "on", " ", "radius"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"propertyNum", "\[Equal]", "1"}], ",", 
        RowBox[{"(*", 
         RowBox[{"if", " ", "the", " ", "variable", " ", 
          RowBox[{"we", "'"}], "re", " ", "trying", " ", "the", " ", "change",
           " ", "is", " ", "the", " ", "radius"}], "*)"}], 
        RowBox[{
         RowBox[{"Do", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Which", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"arrayPosition", "\[NotEqual]", "1"}], "&&", 
               RowBox[{"arrayPosition", "\[NotEqual]", 
                RowBox[{"Length", "[", 
                 RowBox[{"baseAtm", "[", 
                  RowBox[{"[", "propertyNum", "]"}], "]"}], "]"}]}]}], ",", 
              RowBox[{"(*", 
               RowBox[{"if", " ", 
                RowBox[{"it", "'"}], "s", " ", "not", " ", "the", " ", 
                "first", " ", "or", " ", "the", " ", "last", " ", "radius", 
                " ", "boundary"}], "*)"}], 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"varRange", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "<", 
                   RowBox[{"baseAtm", "[", 
                    RowBox[{"[", 
                    RowBox[{"propertyNum", ",", 
                    RowBox[{"i", "-", "1"}]}], "]"}], "]"}]}], "||", 
                  RowBox[{
                   RowBox[{"varRange", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ">", 
                   RowBox[{"baseAtm", "[", 
                    RowBox[{"[", 
                    RowBox[{"propertyNum", ",", 
                    RowBox[{"i", "+", "1"}]}], "]"}], "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{
                  "Print", "[", "\"\<radius range specification error\>\"", 
                   "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"error", "=", "True"}], ";"}]}], "]"}], ";"}], ",", 
              RowBox[{"arrayPosition", "\[Equal]", "1"}], ",", 
              RowBox[{"(*", 
               RowBox[{"bottommost", " ", "boundary"}], "*)"}], 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"varRange", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ">", 
                  RowBox[{"baseAtm", "[", 
                   RowBox[{"[", 
                    RowBox[{"propertyNum", ",", 
                    RowBox[{"i", "+", "1"}]}], "]"}], "]"}]}], ",", 
                 RowBox[{
                  RowBox[{
                  "Print", "[", "\"\<radius range specification error\>\"", 
                   "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"error", "=", "True"}], ";"}]}], "]"}], ";"}], ",", 
              RowBox[{"arrayPosition", "\[Equal]", 
               RowBox[{"Length", "[", 
                RowBox[{"baseAtm", "[", 
                 RowBox[{"[", "propertyNum", "]"}], "]"}], "]"}]}], ",", 
              RowBox[{"(*", 
               RowBox[{"topmost", " ", "boundary"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"varRange", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "<", 
                  RowBox[{"baseAtm", "[", 
                   RowBox[{"[", 
                    RowBox[{"propertyNum", ",", 
                    RowBox[{"i", "-", "1"}]}], "]"}], "]"}]}], ",", 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{
                  "Print", "[", "\"\<radius range specification error\>\"", 
                   "]"}], ";", "\[IndentingNewLine]", 
                  RowBox[{"error", "=", "True"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";"}], ",", 
              "\[IndentingNewLine]", "True", ",", 
              RowBox[{"(*", 
               RowBox[{"boundary", " ", "spec", " ", "error"}], "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
               "Print", "[", "\"\<radius boundary specification error\>\"", 
                "]"}], ";", "\[IndentingNewLine]", 
               RowBox[{"error", "=", "True"}], ";"}]}], "\[IndentingNewLine]",
              "]"}], ";"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{"Length", "[", "varRange", "]"}]}], "}"}]}], "]"}], 
         ";"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"error", ",", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"make", " ", "the", " ", "atmospheres"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"currentAtm", "=", "baseAtm"}], ";", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"currentAtm", "[", 
           RowBox[{"[", 
            RowBox[{"propertyNum", ",", "arrayPosition"}], "]"}], "]"}], "=", 
          RowBox[{"varRange", "[", 
           RowBox[{"[", "i", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"makeAtmosphere", "[", 
          RowBox[{"currentAtm", ",", "exportFolderPath", ",", "atmNum"}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"atmNum", "=", 
          RowBox[{"atmNum", "+", "1"}]}], ";"}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", 
          RowBox[{"Length", "[", "varRange", "]"}]}], "}"}]}], "]"}], ";"}]}],
     "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6302653337330494`*^9, 3.6302654038629007`*^9}, {
  3.6302658157436285`*^9, 3.6302658804636545`*^9}, {3.63026605005017*^9, 
  3.6302660686754074`*^9}, {3.630266326852889*^9, 3.630266372238145*^9}, {
  3.6302664054447756`*^9, 3.6302664586875906`*^9}, {3.630266604374573*^9, 
  3.6302666050440474`*^9}, {3.630267687504382*^9, 3.6302677352233143`*^9}, {
  3.6302677887823925`*^9, 3.630267797362467*^9}, {3.6302692204118657`*^9, 
  3.6302692747304735`*^9}, {3.6303440713845806`*^9, 3.6303440786487246`*^9}, {
  3.6303441443293705`*^9, 3.630344161397503*^9}, {3.630344481826338*^9, 
  3.630344558593053*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Graphics Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6302654517809486`*^9, 3.6302654555076127`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"plotAtmosphereProperties", "[", "atmosphere_", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "TPlot", ",", "PPlot", ",", "MPlot", ",", "\[Rho]nPlot", ",", 
        "\[Alpha]zPlot", ",", "\[Alpha]Plot", ",", "\[ScriptCapitalN]Plot", 
        ",", "atm"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"StringQ", "[", "atmosphere", "]"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"atm", "=", 
           RowBox[{
            RowBox[{"Import", "[", 
             RowBox[{"atmosphere", ",", 
              RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", " ", "1"}]}], "]"}], 
            "\[Transpose]"}]}], ";"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"atm", "=", "atmosphere"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"TPlot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
              "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
               "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "]"}], ",", "2"}], "}"}]}], "]"}], ",", 
          RowBox[{"PlotLabel", "\[Rule]", "\"\<temperature (K)\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", " ", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"MPlot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "3", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
              "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
               "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "]"}], ",", "2"}], "}"}]}], "]"}], ",", 
          RowBox[{"PlotLabel", "\[Rule]", "\"\<M (kg/mol)\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"PPlot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "4", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
              "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
               "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "]"}], ",", "2"}], "}"}]}], "]"}], ",", 
          RowBox[{"PlotLabel", "\[Rule]", "\"\<pressure (Pa)\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", 
       RowBox[{"\[Rho]nPlot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "5", "\[RightDoubleBracket]"}], 
              ",", 
              RowBox[{
              "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}]}],
              "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{
               "atm", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}], 
               "]"}], ",", "2"}], "}"}]}], "]"}], ",", 
          RowBox[{"PlotLabel", "\[Rule]", "\"\<number density\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Alpha]zPlot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{"atm", "[", 
               RowBox[{"[", "6", "]"}], "]"}], ",", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"atm", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "2"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{
          "PlotLabel", "\[Rule]", 
           "\"\<\!\(\*SubscriptBox[\(\[Alpha]\), \(z\)]\)\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"\[Alpha]Plot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{"atm", "[", 
               RowBox[{"[", "7", "]"}], "]"}], ",", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"atm", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "2"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{"PlotLabel", "\[Rule]", "\"\<\[Alpha]\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"this", " ", 
         RowBox[{"one", "'"}], "s", " ", "a", " ", "little", " ", 
         "different"}], " ", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"\[ScriptCapitalN]Plot", "=", 
        RowBox[{"ListPlot", "[", 
         RowBox[{
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"Riffle", "[", 
             RowBox[{
              RowBox[{"atm", "[", 
               RowBox[{"[", "8", "]"}], "]"}], ",", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Length", "[", 
               RowBox[{"atm", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "2"}], "}"}]}], 
           "]"}], ",", 
          RowBox[{
          "PlotLabel", "\[Rule]", 
           "\"\<refractivity (\[ScriptCapitalN])\>\""}], ",", 
          RowBox[{"Filling", "\[Rule]", "Axis"}], ",", 
          RowBox[{"PlotRange", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Min", "[", 
              RowBox[{"atm", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], ",", "All"}], "}"}]}]}],
          "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{
         "TPlot", ",", "MPlot", ",", "PPlot", ",", "\[Rho]nPlot", ",", 
          "\[Alpha]zPlot", ",", "\[Alpha]Plot", ",", 
          "\[ScriptCapitalN]Plot"}], "}"}], "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\n", 
  "\[IndentingNewLine]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.630257612866873*^9, 3.6302576244090757`*^9}, {
   3.6302598143633413`*^9, 3.630259845538508*^9}, {3.6302599108249016`*^9, 
   3.6302599108259025`*^9}, {3.630265132989391*^9, 3.630265149492119*^9}, {
   3.6302652738194647`*^9, 3.6302652844650517`*^9}, {3.6302653268842087`*^9, 
   3.6302653766465673`*^9}, {3.6302654573159122`*^9, 3.630265458157487*^9}, {
   3.6302660745435934`*^9, 3.6302660881242466`*^9}, {3.6302671205544505`*^9, 
   3.630267125269803*^9}, {3.6302671689528604`*^9, 3.630267212777981*^9}, {
   3.6302678309323187`*^9, 3.6302678636125474`*^9}, {3.630267952000372*^9, 
   3.630268015728664*^9}, {3.63026804844692*^9, 3.630268084566591*^9}, {
   3.630268138942232*^9, 3.630268139874896*^9}, {3.630268182733356*^9, 
   3.6302682230790305`*^9}, {3.6302682709070253`*^9, 3.630268285742569*^9}, {
   3.6302683699744368`*^9, 3.630268447799774*^9}, {3.6302687213932056`*^9, 
   3.630268734737713*^9}, 3.630269353066181*^9, {3.6303434986183214`*^9, 
   3.630343518073114*^9}, {3.6303437736293287`*^9, 3.630343773794453*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lightcurve Generation", "Section",
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.6302590895581846`*^9, 3.63025912605415*^9}, {
  3.6302593583032026`*^9, 3.630259373365896*^9}, {3.630265442429305*^9, 
  3.6302654425624*^9}}],

Cell[CellGroupData[{

Cell["Physical Equations", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.630259382254212*^9, 3.630259385269376*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
   "refraction", " ", "as", " ", "a", " ", "function", " ", "of", " ", 
    "angles", " ", "and", " ", "rafractivity", " ", "indicies"}], "*)"}], 
  "\n", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"snellsLaw", "[", 
      RowBox[{"\[Theta]In_", ",", "nIn_", ",", "nOut_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"nIn", "\[Equal]", "nOut"}], ",", "\[Theta]In", ",", 
       RowBox[{"ArcSin", "[", 
        RowBox[{
         RowBox[{"Sin", "[", "\[Theta]In", "]"}], " ", 
         RowBox[{"nIn", "/", "nOut"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
     "decrease", " ", "the", " ", "flux", " ", "of", " ", "a", " ", "single", 
      " ", "light", " ", "beam", " ", "based", " ", "on", " ", "the", " ", 
      "linear", " ", "approximation", " ", "of", " ", "the", " ", "Beer"}], 
     "-", 
     RowBox[{"Lambert", " ", "law"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"beerLambert", "[", 
      RowBox[{"\[Alpha]z_", ",", "flux_", ",", "z_"}], "]"}], ":=", 
     RowBox[{"flux", " ", 
      RowBox[{"E", "^", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{"-", "\[Alpha]z"}], " ", "z"}], ")"}]}]}]}], ";"}], 
   "\n"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6302591424828196`*^9, 3.6302591424848213`*^9}, {
   3.630259323636553*^9, 3.630259324094901*^9}, {3.6302596895205956`*^9, 
   3.6302597127310925`*^9}, 3.630260018196211*^9, {3.6302616934258327`*^9, 
   3.6302616992449856`*^9}, {3.6302651207796955`*^9, 
   3.6302651224298673`*^9}, {3.630269416039937*^9, 3.6302694321443825`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Helper Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6302600379392457`*^9, 3.630260049930751*^9}, 
   3.6302655306830263`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"shells", " ", "are", " ", "composed", " ", "of", " ", "the", " ", 
     RowBox[{"following", ":", 
      RowBox[{"the", " ", "circle", " ", "graphic"}]}]}], ",", 
    RowBox[{"the", " ", "circle", " ", "equation"}], ",", 
    RowBox[{"the", " ", "circle", " ", "radius"}], ",", 
    RowBox[{"the", " ", "n", " ", "value"}], ",", 
    RowBox[{
    "and", " ", "the", " ", "attenuation", " ", "coefficient", " ", 
     "\[Alpha]z"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "note", " ", "that", " ", "attenuation", " ", "coefficient", " ", "is", 
     " ", "represented", " ", "here", " ", "as", " ", "\[Alpha]z", " ", 
     "rather", " ", "than", " ", "\[Alpha]", " ", "because", " ", "the", " ", 
     "letter", " ", "also", " ", "stands", " ", "for", " ", "mean", " ", 
     "polarizability"}], ",", 
    RowBox[{
     RowBox[{
     "which", " ", "is", " ", "used", " ", "elsewhere", " ", "in", " ", 
      "this", " ", "program"}], ";", 
     RowBox[{
      RowBox[{"\[Alpha]z", " ", "implies", " ", 
       RowBox[{"it", "'"}], "s", " ", "a", " ", "function", " ", "of", " ", 
       "z"}], "-", 
      RowBox[{
      "the", " ", "distance", " ", "the", " ", "beam", " ", "of", " ", 
       "light", " ", "travelled", " ", "in", " ", "the", " ", 
       "material"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"shell", "[", 
      RowBox[{"r_", ",", "n_", ",", "\[Alpha]z_"}], "]"}], ":=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Circle", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"0", ",", "0"}], "}"}], ",", "r"}], "]"}], ",", 
       RowBox[{
        RowBox[{
         RowBox[{"x", "^", "2"}], "+", 
         RowBox[{"y", "^", "2"}]}], "\[Equal]", 
        RowBox[{"r", "^", "2"}]}], ",", "r", ",", "n", ",", "\[Alpha]z"}], 
      "}"}]}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{
      RowBox[{
      "calculate", " ", "the", " ", "normal", " ", "angle", " ", "of", " ", 
       "a", " ", "shell", " ", "based", " ", "on", " ", "location"}], ",", 
      RowBox[{
      "assuming", " ", "shells", " ", "centered", " ", "at", " ", "0"}], ",", 
      "0"}], ")"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"normalAngle", "[", "point_", "]"}], ":=", 
     RowBox[{"ArcTan", "[", 
      RowBox[{
       RowBox[{"point", "[", 
        RowBox[{"[", "1", "]"}], "]"}], ",", 
       RowBox[{"point", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\n", 
   RowBox[{"(*", 
    RowBox[{
    "helper", " ", "function", " ", "to", " ", "negate", " ", "the", " ", "y",
      " ", "term", " ", "of", " ", "an", " ", "xy", " ", "pair", " ", "for", 
     " ", "flipping", " ", "atmospheric", " ", "intersection", " ", 
     "points"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"flipY", "[", 
      RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
     RowBox[{"Return", "[", 
      RowBox[{"{", 
       RowBox[{"x", ",", 
        RowBox[{"-", "y"}]}], "}"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "find", " ", "the", " ", "next", " ", "location", " ", "of", " ", "an", 
     " ", "intersection", " ", "given", " ", "a", " ", "ray"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"findNextShellIntersection", "[", 
      RowBox[{"radius_", ",", "rayPosition_", ",", "rayAngle_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "x0", ",", "y0", ",", "m", ",", "t1", ",", "t2", ",", "tList"}], 
        "}"}], ",", 
       RowBox[{"(*", 
        RowBox[{"TODO", "-", 
         RowBox[{
          RowBox[{"can", "'"}], "t", " ", "I", " ", "just", " ", "figure", 
          " ", "out", " ", "radius", " ", "from", " ", 
          RowBox[{"position", "?"}]}]}], "*)"}], 
       RowBox[{
        RowBox[{"x0", "=", 
         RowBox[{"rayPosition", "[", 
          RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"y0", "=", 
         RowBox[{"rayPosition", "[", 
          RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"m", "=", 
         RowBox[{"Tan", "[", "rayAngle", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t1", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "x0"}], "-", 
            RowBox[{"m", " ", "y0"}], "+", 
            RowBox[{"\[Sqrt]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"radius", "^", "2"}], " ", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"m", "^", "2"}]}], ")"}]}], "-", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y0", "-", 
                  RowBox[{"m", " ", "x0"}]}], ")"}], "^", "2"}]}], ")"}]}]}], 
           ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"m", "^", "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"t2", "=", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"-", "x0"}], "-", 
            RowBox[{"m", " ", "y0"}], "-", 
            RowBox[{"\[Sqrt]", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"radius", "^", "2"}], " ", 
                RowBox[{"(", 
                 RowBox[{"1", "+", 
                  RowBox[{"m", "^", "2"}]}], ")"}]}], "-", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"y0", "-", 
                  RowBox[{"m", " ", "x0"}]}], ")"}], "^", "2"}]}], ")"}]}]}], 
           ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"1", "+", 
            RowBox[{"m", "^", "2"}]}], ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"tList", "=", 
         RowBox[{"Select", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"t1", ",", "t2"}], "}"}], ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"#", "\[Element]", "Reals"}], "&&", 
              RowBox[{"#", ">", "TOL"}]}], ")"}], "&"}]}], "]"}]}]}]}], " ", 
      RowBox[{"(*", 
       RowBox[{
       "return", " ", "only", " ", "real", " ", "positive", " ", "time", " ", 
        "values"}], "*)"}], "\[IndentingNewLine]", "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "function", " ", "that", " ", "identifies", " ", "where", " ", "the", " ",
      "light", " ", "currently", " ", "is", " ", "in", " ", "relation", " ", 
     "to", " ", "shells"}], " ", "*)"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"locateLightRay", "[", 
      RowBox[{"position_", ",", "atm_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "shellRadii", ",", "posRadius", ",", "difference", ",", "shellNum", 
         ",", "rayLocation"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"shellRadii", " ", "=", " ", 
         RowBox[{"atm", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"posRadius", " ", "=", " ", 
         RowBox[{"Norm", "[", "position", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{"entirely", " ", "outside", " ", "of", " ", "shells"}], " ",
           "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"posRadius", " ", ">", " ", 
           RowBox[{"Last", "[", "shellRadii", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"rayLocation", " ", "=", " ", "\"\<outside\>\""}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "entirely", " ", "inside", " ", "the", " ", "inner", " ", 
            "shell"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"posRadius", " ", "<", " ", 
           RowBox[{"First", "[", "shellRadii", "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"rayLocation", " ", "=", " ", "\"\<inside\>\""}], ",", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{"on", " ", "outer", " ", "shell"}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{
             RowBox[{"Last", "[", "shellRadii", "]"}], "-", " ", 
             "posRadius"}], "]"}], "<", "TOL"}], ",", "\[IndentingNewLine]", 
          RowBox[{"rayLocation", " ", "=", " ", "\"\<on outer shell\>\""}], 
          ",", "\[IndentingNewLine]", "\[IndentingNewLine]", "True", ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"Do", "[", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"difference", " ", "=", " ", 
               RowBox[{"Abs", "[", 
                RowBox[{"posRadius", "-", 
                 RowBox[{"shellRadii", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{"difference", "<", "TOL"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"shellNum", " ", "=", " ", "i"}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"rayLocation", "=", "\"\<on\>\""}], ";", 
                 "\[IndentingNewLine]", 
                 RowBox[{"Break", "[", "]"}], ";"}], ",", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"rayLocation", " ", "=", " ", "\"\<between\>\""}], 
                 ";"}]}], "\[IndentingNewLine]", "]"}], ";"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"Length", "[", "atm", "]"}]}], "}"}]}], 
            "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "rayLocation", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "get", " ", "the", " ", "breakpoints", " ", "in", " ", "the", " ", 
     "interpolating", " ", "functions", " ", "for", " ", "lightcurve", " ", 
     "generation"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "the", " ", "magnitude", " ", "and", " ", "density", " ", 
      "interpolations", " ", "have", " ", "slightly", " ", "different", " ", 
      "domains"}], ",", 
     RowBox[{
     "so", " ", "we", " ", "have", " ", "to", " ", "choose", " ", "the", " ", 
      "intersections", " ", "of", " ", "their", " ", "domains"}]}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"getBreakpoints", "[", 
     RowBox[{
     "magFunc1_", ",", "densityFunc1_", ",", "magFunc2_", ",", 
      "densityFunc2_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"x1", ",", "x2", ",", "x3", ",", "x4"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"x1", "=", 
        RowBox[{"Max", "[", 
         RowBox[{
          RowBox[{"magFunc1", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"densityFunc1", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"max", " ", "of", " ", "right", " ", "side", " ", "minimum"}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"x2", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"magFunc1", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"densityFunc1", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"min", " ", "of", " ", "right", " ", "side", " ", "maximum"}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"x3", "=", 
        RowBox[{"Max", "[", 
         RowBox[{
          RowBox[{"magFunc2", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], ",", 
          RowBox[{"densityFunc2", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"max", " ", "of", " ", "left", " ", "side", " ", "minimum"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"x4", "=", 
        RowBox[{"Min", "[", 
         RowBox[{
          RowBox[{"magFunc2", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}], ",", 
          RowBox[{"densityFunc2", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "1", ",", "2"}], "]"}], "]"}]}], "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"min", " ", "of", " ", "left", " ", "side", " ", "maximum"}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"x1", ",", "x2", ",", "x3", ",", "x4"}], "}"}], "]"}], 
       ";"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]"}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6302591424828196`*^9, 3.6302591424848213`*^9}, {
   3.630259323636553*^9, 3.630259324094901*^9}, {3.6302596895205956`*^9, 
   3.6302597127310925`*^9}, {3.630260018196211*^9, 3.6302600331578293`*^9}, {
   3.6302601043814497`*^9, 3.63026010582848*^9}, {3.6302601723857822`*^9, 
   3.630260195474193*^9}, {3.630260371038974*^9, 3.630260404758937*^9}, {
   3.630261216995221*^9, 3.6302612280630856`*^9}, 3.63026947178956*^9, {
   3.6302695058677816`*^9, 3.630269545786152*^9}, {3.630269588831747*^9, 
   3.6302696066574144`*^9}, {3.630269639279623*^9, 3.630269670023451*^9}, {
   3.6304222765292044`*^9, 3.6304225042616177`*^9}, {3.630422594744748*^9, 
   3.6304226057345448`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Ray Tracing Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.630261554712274*^9, 3.6302615711309147`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "updates", " ", "the", " ", "light", " ", "position", " ", "based", " ", 
     "on", " ", "current", " ", "position"}], ",", " ", "direction", ",", " ", 
    RowBox[{"and", " ", "shells"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"moveLightRay", "[", 
      RowBox[{"rayPath_", ",", "rayAngle_", ",", "atm_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "location", ",", "tList", ",", "intersect", ",", "t", ",", "n2", ",", 
         "\[Alpha]z", ",", "position", ",", "posRadius", ",", "shellNum", ",",
          "noIntersect", ",", "atEnd", ",", "distTravelledInShell"}], "}"}], 
       ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"extincted", " ", "=", " ", "False"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"position", " ", "=", " ", 
         RowBox[{"Last", "[", "rayPath", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"posRadius", " ", "=", " ", 
         RowBox[{"Norm", "[", "position", "]"}]}], ";", "\[IndentingNewLine]",
         "\[IndentingNewLine]", 
        RowBox[{"location", "  ", "=", " ", 
         RowBox[{"locateLightRay", "[", 
          RowBox[{"position", ",", "atm"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "only", " ", "need", " ", "to", " ", "check", " ", "the", " ", 
           "outermost", " ", "shell"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"location", " ", "\[Equal]", " ", "\"\<outside\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"t", " ", "=", " ", 
             RowBox[{"Min", "[", 
              RowBox[{"findNextShellIntersection", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Last", "[", "atm", "]"}], "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", "position", ",", 
                "rayAngle"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
           "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
           "only", " ", "need", " ", "to", " ", "check", " ", "the", " ", 
            "innermost", " ", "shell"}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"location", " ", "\[Equal]", " ", "\"\<inside\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"t", " ", "=", " ", 
             RowBox[{"Min", "[", 
              RowBox[{"findNextShellIntersection", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"First", "[", "atm", "]"}], "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", "position", ",", 
                "rayAngle"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
           "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "only", " ", "need", " ", "to", " ", "check", " ", "the", " ", 
             "second"}], "-", 
            RowBox[{
            "outermost", " ", "and", " ", "itself", " ", "shell", " ", 
             "unless", " ", 
             RowBox[{"it", "'"}], "s", " ", "a", " ", "one"}], "-", 
            RowBox[{"shell", " ", "atmosphere"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{
          "location", " ", "\[Equal]", " ", "\"\<on outer shell\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "atm", "]"}], ">", "1"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"if", " ", 
                RowBox[{"it", "'"}], "s", " ", "a", " ", "multi"}], "-", 
               RowBox[{"shell", " ", "atmosphere"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t", " ", "=", " ", 
                RowBox[{"Min", "[", 
                 RowBox[{"Join", "[", "\[IndentingNewLine]", 
                  RowBox[{
                   RowBox[{"findNextShellIntersection", "[", 
                    RowBox[{
                    RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "2"}], ",", "3"}], "]"}], "]"}], ",", 
                    "position", ",", "rayAngle"}], "]"}], ",", 
                   "\[IndentingNewLine]", 
                   RowBox[{"findNextShellIntersection", "[", 
                    RowBox[{
                    RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "3"}], "]"}], "]"}], ",", 
                    "position", ",", "rayAngle"}], "]"}]}], 
                  "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
                 "]"}]}], ";"}], "\[IndentingNewLine]", "}"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"else", " ", "if", " ", 
                RowBox[{"it", "'"}], "s", " ", "a", " ", "single"}], "-", 
               RowBox[{"shell", " ", "atmosphere"}]}], " ", "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"t", " ", "=", " ", 
                RowBox[{"Min", "[", 
                 RowBox[{"findNextShellIntersection", "[", 
                  RowBox[{
                   RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "3"}], "]"}], "]"}], ",", "position", 
                   ",", "rayAngle"}], "]"}], "]"}]}], ";"}], 
              "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], 
           "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "need", " ", "to", " ", "check", " ", "the", " ", "previous"}], 
            ",", " ", "current", ",", " ", 
            RowBox[{"and", " ", "next", " ", "shells"}]}], " ", "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"location", " ", "\[Equal]", " ", "\"\<on\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"Do", "[", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Abs", "[", 
                   RowBox[{"posRadius", "-", 
                    RowBox[{
                    RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "3"}], "]"}], "]"}], "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "<", "TOL"}], 
                 ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"shellNum", " ", "=", " ", "i"}], ";", 
                  "\[IndentingNewLine]", 
                  RowBox[{"Break", "[", "]"}], ";"}], ","}], 
                "\[IndentingNewLine]", "]"}], ";"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "atm", "]"}]}], "}"}]}], 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"shellNum", "\[Equal]", "1"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
                RowBox[{"if", " ", "on", " ", "inner", " ", "shell"}], " ", 
                "-", " ", 
                RowBox[{
                "the", " ", "innermost", " ", "shell", " ", "represents", " ",
                  "the", " ", "planet", " ", "itself"}]}], " ", "*)"}], 
              "\[IndentingNewLine]", 
              RowBox[{"{", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"extincted", " ", "=", " ", "True"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"t", " ", "=", "0"}], ";"}], "\[IndentingNewLine]", 
               "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
              RowBox[{"(*", " ", 
               RowBox[{
               "if", " ", "on", " ", "some", " ", "other", " ", "shell"}], 
               " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"t", " ", "=", " ", 
               RowBox[{"Min", "[", 
                RowBox[{"Join", "[", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"findNextShellIntersection", "[", 
                   RowBox[{
                    RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"shellNum", "+", "1"}], ",", "3"}], "]"}], "]"}], 
                    ",", "position", ",", "rayAngle"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"findNextShellIntersection", "[", 
                   RowBox[{
                    RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{"shellNum", ",", "3"}], "]"}], "]"}], ",", 
                    "position", ",", "rayAngle"}], "]"}], ",", 
                  "\[IndentingNewLine]", 
                  RowBox[{"findNextShellIntersection", "[", 
                   RowBox[{
                    RowBox[{"atm", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"shellNum", "-", "1"}], ",", "3"}], "]"}], "]"}], 
                    ",", "position", ",", "rayAngle"}], "]"}]}], 
                 "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
                "]"}]}]}], "\[IndentingNewLine]", "]"}], ";"}], 
           "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "need", " ", "to", " ", "check", " ", "the", " ", "shells", " ", 
             "that", " ", "it", " ", "is", " ", "between"}], "-", " ", 
            RowBox[{
            "now", " ", "use", " ", "currentShell", " ", "as", " ", "a", " ", 
             "counter"}]}], " ", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"location", " ", "\[Equal]", " ", "\"\<between\>\""}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"{", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{
            "Print", "[", 
             "\"\<warning: between atmosphere layers - this shouldn't really \
happen\>\"", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"shellNum", " ", "=", 
             RowBox[{"Length", "[", "atm", "]"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"While", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"atm", "[", 
                RowBox[{"[", 
                 RowBox[{"shellNum", ",", "3"}], "]"}], "]"}], " ", ">", " ", 
               "posRadius"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"shellNum", "-=", "1"}], ";"}]}], " ", 
             "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
            RowBox[{"tList", " ", "=", " ", 
             RowBox[{"Join", "[", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"findNextShellIntersection", "[", 
                RowBox[{
                 RowBox[{"atm", "[", 
                  RowBox[{"[", 
                   RowBox[{"shellNum", ",", "3"}], "]"}], "]"}], ",", 
                 "position", ",", "rayAngle"}], "]"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"findNextShellIntersection", "[", 
                RowBox[{
                 RowBox[{"atm", "[", 
                  RowBox[{"[", 
                   RowBox[{
                    RowBox[{"shellNum", "+", "1"}], ",", "3"}], "]"}], "]"}], 
                 ",", "position", ",", "rayAngle"}], "]"}]}], 
              "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
            RowBox[{"t", "=", " ", 
             RowBox[{"Min", "[", "tList", "]"}]}], ";"}], 
           "\[IndentingNewLine]", "}"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
         "stuff", " ", "to", " ", "be", " ", "done", " ", "regardless", " ", 
          "of", " ", "ray", " ", "location", " ", "case"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{"check", " ", "for", " ", "non"}], "-", 
          RowBox[{"intersection", " ", "case"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"noIntersect", " ", "=", " ", "False"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"atEnd", " ", "=", " ", "False"}], ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"t", "\[Equal]", "Infinity"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Length", "[", "rayPath", "]"}], "\[Equal]", "1"}], ",",
              "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"noIntersect", " ", "=", " ", "True"}], ";"}]}], 
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
           RowBox[{"atEnd", " ", "=", " ", "True"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"t", "=", "distToObserver"}], ";"}]}], " ", 
         RowBox[{"(*", " ", 
          RowBox[{
          "move", " ", "the", " ", "end", " ", "of", " ", "the", " ", "light",
            " ", "beam", " ", "to", " ", "the", " ", "observer", " ", 
           "position"}], " ", "*)"}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"intersect", " ", "=", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"t", "+", 
            RowBox[{"position", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Tan", "[", "rayAngle", "]"}], " ", "t"}], " ", "+", " ", 
            RowBox[{"position", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"position", " ", "=", " ", "intersect"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"figure", " ", "out", " ", "which", " ", 
          RowBox[{"we", "'"}], "re", " ", "now", " ", "interacting", " ", 
          "with"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Abs", "[", 
               RowBox[{
                RowBox[{"Norm", "[", "position", "]"}], "-", 
                RowBox[{
                 RowBox[{"atm", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "3"}], "]"}], "]"}], "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}], "<", "TOL"}], ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"n2", " ", "=", " ", 
               RowBox[{"atm", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "4"}], "]"}], "]"}]}], ";", " ", 
              RowBox[{"(*", " ", 
               RowBox[{
               "get", " ", "the", " ", "refractivity", " ", "of", " ", "the", 
                " ", "shell"}], " ", "*)"}], "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"!", "extincted"}], " ", "&&", " ", 
                 RowBox[{"i", ">", "1"}]}], ",", "\[IndentingNewLine]", 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"\[Alpha]z", "=", 
                  RowBox[{"atm", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "-", "1"}], ",", "5"}], "]"}], "]"}]}], 
                 ";"}], ",", " ", 
                RowBox[{"(*", " ", 
                 RowBox[{
                 "get", " ", "the", " ", "attenuation", " ", "coefficient", 
                  " ", "of", " ", "the", " ", "shell", " ", "to", " ", "the", 
                  " ", "interior", " ", "of", " ", "this", " ", "one"}], " ", 
                 "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"\[Alpha]z", "=", "0"}], ";"}]}], " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                 "if", " ", "already", " ", "extincted", " ", "or", " ", "in",
                   " ", "inner", " ", "shell"}], ",", " ", 
                 RowBox[{"this", " ", 
                  RowBox[{"doesn", "'"}], "t", " ", "actually", " ", 
                  "matter"}]}], " ", "*)"}], "\[IndentingNewLine]", "]"}], 
              ";", "\[IndentingNewLine]", 
              RowBox[{"Break", "[", "]"}], ";"}], ",", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", " ", 
              RowBox[{
               RowBox[{"if", " ", 
                RowBox[{"we", "'"}], "re", " ", "not", " ", "interacting", 
                " ", "with", " ", "a", " ", "shell"}], ",", " ", 
               RowBox[{
                RowBox[{"then", " ", 
                 RowBox[{"we", "'"}], "re", " ", "back", " ", "in", " ", 
                 "vacuum", " ", "with", " ", "n2"}], " ", "=", " ", 
                RowBox[{
                 RowBox[{"1.0", " ", "and", " ", "\[Alpha]z"}], " ", "=", " ",
                  "0"}]}]}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"n2", " ", "=", " ", "1.0"}], ";", 
              "\[IndentingNewLine]", 
              RowBox[{"\[Alpha]z", "=", "0"}], ";"}]}], "\[IndentingNewLine]",
             "]"}], ";"}], ",", "\[IndentingNewLine]", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"Length", "[", "atm", "]"}]}], "}"}]}], 
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "if", " ", "the", " ", "light", " ", "has", " ", "not", " ", "been",
            " ", "entirely", " ", "extincted", " ", "yet"}], ",", " ", 
          RowBox[{
          "append", " ", "the", " ", "angle", " ", "and", " ", "final", " ", 
           "flux", " ", "level", " ", "to", " ", "the", " ", "appropriate", 
           " ", "lists"}]}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", "extincted"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"intersectionPoints", ",", "position"}], "]"}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"Which", "[", "\[IndentingNewLine]", 
            RowBox[{"noIntersect", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"angleList", ",", "0.0"}], "]"}], ";"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "atEnd", ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"angleList", ",", "rayAngle"}], "]"}], ";"}], ",", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", "True", ",", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"AppendTo", "[", 
               RowBox[{"angleList", ",", 
                RowBox[{"refract", "[", 
                 RowBox[{"intersectionPoints", ",", "angleList", ",", "n2"}], 
                 "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
              "\[IndentingNewLine]", 
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", "intersectionPoints", "]"}], ">", 
                 "2"}], " ", ",", " ", 
                RowBox[{"(*", " ", 
                 RowBox[{"if", " ", 
                  RowBox[{"we", "'"}], "re", " ", "not", " ", "at", " ", 
                  "the", " ", "starting", " ", "point", " ", "or", " ", 
                  "first", " ", "intersection", " ", "point"}], " ", "*)"}], 
                "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"distTravelledInShell", " ", "=", " ", 
                  RowBox[{"\[Sqrt]", 
                   RowBox[{"(", 
                    RowBox[{
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"intersectionPoints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", "intersectionPoints", "]"}], ",", 
                    "1"}], "]"}], "]"}], "-", 
                    RowBox[{"intersectionPoints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "intersectionPoints", "]"}], "-", 
                    "1"}], ",", "1"}], "]"}], "]"}]}], ")"}], "2"], "+", 
                    SuperscriptBox[
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"intersectionPoints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"Length", "[", "intersectionPoints", "]"}], ",", 
                    "2"}], "]"}], "]"}], "-", 
                    RowBox[{"intersectionPoints", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "intersectionPoints", "]"}], "-", 
                    "1"}], ",", "2"}], "]"}], "]"}]}], ")"}], "2"]}], 
                    ")"}]}]}], ";"}], ",", "\[IndentingNewLine]", 
                RowBox[{
                 RowBox[{"distTravelledInShell", "=", "0"}], ";"}]}], 
               "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
              RowBox[{"currentRayFlux", "=", 
               RowBox[{"beerLambert", "[", 
                RowBox[{
                "\[Alpha]z", ",", "currentRayFlux", ",", 
                 "distTravelledInShell"}], "]"}]}], ";"}]}], " ", 
            RowBox[{"(*", " ", 
             RowBox[{"calculate", " ", "light", " ", "extinction"}], " ", 
             "*)"}], "\[IndentingNewLine]", "]"}], ";"}]}], 
         "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
    "refract", " ", "based", " ", "on", " ", "entry", " ", "and", " ", 
     "shell", " ", "conditions", " ", "using", " ", 
     RowBox[{"Snell", "'"}], "s", " ", "Law"}], "*)"}], 
   RowBox[{
    RowBox[{
     RowBox[{"refract", "[", 
      RowBox[{"rayPath_", ",", "angles_", ",", "n2_"}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "newAngle", ",", "position", ",", "prevPosition", ",", "\[Theta]1", 
         ",", "\[Theta]2", ",", "angle", ",", "interactionType"}], "}"}], ",", 
       RowBox[{
        RowBox[{"position", "=", 
         RowBox[{"Last", "[", "rayPath", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"prevPosition", "=", 
         RowBox[{"rayPath", "[", 
          RowBox[{"[", 
           RowBox[{"-", "2"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"angle", "=", 
         RowBox[{"Last", "[", "angles", "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"interactionType", "=", "Null"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Which", "[", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{"hitting", " ", "the", " ", "same", " ", "shell", " ", 
            RowBox[{"again", "--"}], " ", "wait"}], ",", 
           RowBox[{"I", " ", 
            RowBox[{"shouldn", "'"}], "t", " ", "actually", " ", "need", " ", 
            "this"}], ",", 
           RowBox[{
           "it", " ", "should", " ", "be", " ", "included", " ", "in", " ", 
            "the", " ", 
            RowBox[{"Snell", "'"}], "s", " ", "Law", " ", "function"}]}], 
          "*)"}], 
         RowBox[{
          RowBox[{"currentN", "\[Equal]", "n2"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"interactionType", "=", "\"\<same shell\>\""}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"newAngle", "=", "angle"}], ";"}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "just", " ", "grazed", " ", "the", " ", "top", " ", "or", " ", 
             "bottom", " ", "of", " ", "a", " ", "shell", " ", 
             RowBox[{"(", 
              RowBox[{"no", " ", "interaction"}], ")"}]}], ",", 
            RowBox[{
            "keep", " ", "the", " ", "angle", " ", "the", " ", "same"}]}], 
           "*)"}], 
          RowBox[{
           RowBox[{"Abs", "[", 
            RowBox[{"position", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "<", "TOL"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"interactionType", "=", "\"\<grazed\>\""}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"newAngle", "=", "angle"}], ";"}], "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"\"\<grazed shell with angle = \>\"", "<>", 
               RowBox[{"ToString", "[", "angle", "]"}], "<>", 
               "\"\< and starting y value of \>\"", "<>", 
               RowBox[{"ToString", "[", "yStart", "]"}]}], "]"}], ";"}], 
            "*)"}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "hitting", " ", "shell", " ", "from", " ", "outside", " ", "in", 
            " ", 
            RowBox[{"(", 
             RowBox[{"radius", " ", "decreasing"}], ")"}]}], "*)"}], 
          RowBox[{
           RowBox[{"Norm", "[", "position", "]"}], "<", 
           RowBox[{"Norm", "[", "prevPosition", "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"interactionType", "=", "\"\<outside in\>\""}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"position", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", 
              RowBox[{"{", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"above", " ", "the", " ", "y"}], "=", 
                 RowBox[{"0", " ", "line"}]}], "*)"}], 
               RowBox[{
                RowBox[{"\[Theta]1", "=", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"\[Pi]", "-", 
                    RowBox[{"normalAngle", "[", "position", "]"}], "+", 
                    "angle"}], ",", 
                   RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"Abs", "[", "\[Theta]1", "]"}]}], "<", 
                   RowBox[{"10", "^", 
                    RowBox[{"-", "5"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"Print", "[", "\[Theta]1", "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", "position", "]"}], ";"}]}], "]"}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"\[Theta]2", "=", 
                 RowBox[{"snellsLaw", "[", 
                  RowBox[{"\[Theta]1", ",", "currentN", ",", "n2"}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"newAngle", "=", 
                 RowBox[{
                  RowBox[{"normalAngle", "[", "position", "]"}], "-", "\[Pi]",
                   "+", "\[Theta]2"}]}], ";"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "on", " ", "or", " ", "below", " ", "the", " ", "y"}], "=", 
                 RowBox[{"0", " ", "line"}]}], "*)"}], 
               RowBox[{
                RowBox[{"\[Theta]1", "=", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"normalAngle", "[", "position", "]"}], "-", 
                    "\[Pi]", "-", "angle"}], ",", 
                   RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"\[Theta]2", "=", 
                 RowBox[{"snellsLaw", "[", 
                  RowBox[{"\[Theta]1", ",", "currentN", ",", "n2"}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"newAngle", "=", 
                 RowBox[{
                  RowBox[{"normalAngle", "[", "position", "]"}], "-", "\[Pi]",
                   "-", "\[Theta]2"}]}], ";"}], "}"}]}], "]"}]}], "}"}], ",", 
          RowBox[{"(*", 
           RowBox[{
           "hitting", " ", "shell", " ", "from", " ", "inside", " ", "out"}], 
           "*)"}], 
          RowBox[{
           RowBox[{
            RowBox[{"Norm", "[", "position", "]"}], ">", 
            RowBox[{"Norm", "[", "prevPosition", "]"}]}], "||", 
           RowBox[{
            RowBox[{"Norm", "[", "position", "]"}], "\[Equal]", 
            RowBox[{"Norm", "[", "prevPosition", "]"}]}]}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"interactionType", "=", "\"\<outside in\>\""}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"position", "[", 
                RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", 
              RowBox[{"{", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{"above", " ", "the", " ", "y"}], "=", 
                 RowBox[{"zero", " ", "line"}]}], "*)"}], 
               RowBox[{
                RowBox[{"\[Theta]1", "=", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"normalAngle", "[", "position", "]"}], "-", 
                    "angle"}], ",", 
                   RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"If", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{
                    RowBox[{"\[Pi]", "/", "2"}], "-", 
                    RowBox[{"Abs", "[", "\[Theta]1", "]"}]}], "<", 
                   RowBox[{"10", "^", 
                    RowBox[{"-", "5"}]}]}], ",", 
                  RowBox[{
                   RowBox[{"Print", "[", "\[Theta]1", "]"}], ";", 
                   "\[IndentingNewLine]", 
                   RowBox[{"Print", "[", "position", "]"}], ";"}]}], "]"}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"\[Theta]2", "=", 
                 RowBox[{"snellsLaw", "[", 
                  RowBox[{"\[Theta]1", ",", "currentN", ",", "n2"}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"newAngle", "=", 
                 RowBox[{
                  RowBox[{"normalAngle", "[", "position", "]"}], "-", 
                  "\[Theta]2"}]}], ";"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"(*", 
                RowBox[{
                 RowBox[{
                 "on", " ", "or", " ", "below", " ", "the", " ", "y"}], "=", 
                 RowBox[{"0", " ", "line"}]}], "*)"}], 
               RowBox[{
                RowBox[{"\[Theta]1", "=", 
                 RowBox[{"Mod", "[", 
                  RowBox[{
                   RowBox[{"angle", "-", 
                    RowBox[{"normalAngle", "[", "position", "]"}]}], ",", 
                   RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"\[Theta]2", "=", 
                 RowBox[{"snellsLaw", "[", 
                  RowBox[{"\[Theta]1", ",", "currentN", ",", "n2"}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"newAngle", "=", 
                 RowBox[{
                  RowBox[{"normalAngle", "[", "position", "]"}], "+", 
                  "\[Theta]2"}]}], ";"}], "}"}]}], "]"}]}], "}"}]}], "]"}], 
        ";", "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"interactionType", "\[NotEqual]", "\"\<grazed\>\""}], ",", 
          RowBox[{
           RowBox[{"currentN", "=", "n2"}], ";"}]}], "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"newAngle", "=", 
         RowBox[{"Mod", "[", 
          RowBox[{"newAngle", ",", 
           RowBox[{"2", " ", "\[Pi]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"(*", 
         RowBox[{
          RowBox[{"TODO", "-", 
           RowBox[{
           "probably", " ", "more", " ", "elegent", " ", "way", " ", "to", 
            " ", "do", " ", "the", " ", "angle", " ", "formatting"}]}], ",", 
          RowBox[{
          "because", " ", "I", " ", "basically", " ", "want", " ", "all", " ",
            "angles", " ", "to", " ", "be", " ", "near", " ", "zero", " ", 
           "for", " ", "readability"}]}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"newAngle", ">", 
           RowBox[{"3", "*", 
            RowBox[{"\[Pi]", "/", "4"}]}]}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"newAngle", "=", 
            RowBox[{"newAngle", "-", 
             RowBox[{"2", "*", "\[Pi]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
         "]"}], ";", "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "newAngle", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"rayTrace", "[", 
      RowBox[{
       RowBox[{"maxLightY_:", "1.5"}], ",", 
       RowBox[{"minLightY_:", "0"}]}], "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"startingPosition", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"store", " ", "starting", " ", "y", " ", "coordiate"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"endingPosition", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "store", " ", "the", " ", "ending", " ", "y", " ", "coordinate"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"totalRefraction", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "store", " ", "final", " ", "angles", " ", "from", " ", 
          "refraction"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"finalFlux", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "store", " ", "the", " ", "final", " ", "flux", " ", "per", " ", 
          "beam", " ", "as", " ", "a", " ", "fraction", " ", "of", " ", "the",
           " ", 
          RowBox[{"beam", "'"}], "s", " ", "original", " ", "flux"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"d\[Theta]Overdy", "=", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "store", " ", "a", " ", "difference", " ", "element", " ", "of", " ",
           "the", " ", "above"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"atmGraphics", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "store", " ", "the", " ", "graphics", " ", "generated", " ", "by", 
          " ", "the", " ", "atmosphere", " ", "model", " ", "and", " ", "the",
           " ", "light", " ", "rays"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"numIntersectionPoints", " ", "=", " ", 
         RowBox[{"{", "}"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "store", " ", "the", " ", "number", " ", "of", " ", "intersections", 
          " ", "encountered", " ", "by", " ", "each", " ", "light", " ", 
          "ray"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"extinctionY", " ", "=", " ", "0"}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "optimization", " ", "thing", " ", "to", " ", "allow", " ", 
          "skipping", " ", "over", " ", "light", " ", "rays", " ", "that", 
          " ", "would", " ", "be", " ", "blocked", " ", "by", " ", "Pluto"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"beamsGenerated", " ", "=", " ", "0"}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "count", " ", "the", " ", "number", " ", "of", " ", "beams", " ", 
          "generated"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"beamsHittingAtm", " ", "=", " ", "0"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{
          RowBox[{
          "maxLightY", " ", "is", " ", "the", " ", "maximum", " ", 
           "multiplication", " ", "factor", " ", "for", " ", "the", " ", "y", 
           " ", "starting", " ", "location", " ", "of", " ", "light", " ", 
           "beams"}], ",", " ", 
          RowBox[{
          "to", " ", "be", " ", "multiplied", " ", "by", " ", "maximum", " ", 
           "atmosphere", " ", "specified"}]}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"stepLightY", " ", "=", " ", 
         RowBox[{
          RowBox[{"-", "atmStep"}], "/", "atmMax"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"TODO", " ", "-", " ", 
          RowBox[{
          "does", " ", "this", " ", "make", " ", "sense", " ", "to", " ", 
           RowBox[{"do", "?"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<layers \>\"", " ", "<>", " ", 
          RowBox[{"ToString", "[", "layers", "]"}]}], "]"}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Do", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{
            RowBox[{"yStart", " ", "=", " ", 
             RowBox[{"atmMax", "*", "yMultFact"}]}], ";", 
            RowBox[{"(*", " ", 
             RowBox[{
             "parameterized", " ", "to", " ", "actual", " ", "starting", " ", 
              "location"}], " ", "*)"}], "\[IndentingNewLine]", 
            RowBox[{"beamsGenerated", " ", "=", " ", 
             RowBox[{"beamsGenerated", " ", "+", " ", "1"}]}], ";", 
            "\[IndentingNewLine]", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Abs", "[", "yStart", "]"}], ">", 
               RowBox[{"Abs", "[", "extinctionY", "]"}]}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"yMultTemp", " ", "=", " ", 
                RowBox[{"PrintTemporary", "[", 
                 RowBox[{"\"\<y multiplicative factor \>\"", " ", "<>", " ", 
                  RowBox[{"ToString", "[", "yMultFact", "]"}]}], "]"}]}], ";",
                " ", 
               RowBox[{"(*", " ", 
                RowBox[{"for", " ", "tracking", " ", "progress"}], " ", 
                "*)"}], "\[IndentingNewLine]", 
               RowBox[{"origin", " ", "=", " ", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"-", "atmMax"}], "*", "1.25"}], ",", "yStart"}], 
                 "}"}]}], ";", " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                "origin", " ", "needs", " ", "to", " ", "be", " ", 
                 "specified", " ", "by", " ", "doubles", " ", "rather", " ", 
                 "than", " ", "ints"}], " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"angle", " ", "=", " ", "0"}], ";", " ", 
               RowBox[{"(*", " ", 
                RowBox[{"starting", " ", "angle"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"currentN", " ", "=", " ", "1.0"}], ";", " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                "refractivity", " ", "of", " ", "the", " ", "light", " ", 
                 RowBox[{"ray", "'"}], "s", " ", "initial", " ", 
                 "environment", " ", 
                 RowBox[{"(", "vacuum", ")"}]}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"currentRayFlux", " ", "=", " ", "1.0"}], ";", " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                 RowBox[{
                 "store", " ", "the", " ", "current", " ", "flux", " ", "of", 
                  " ", "the", " ", "ray", " ", "that", " ", 
                  RowBox[{"we", "'"}], "re", " ", "looking", " ", "at"}], ",",
                  " ", 
                 RowBox[{
                 "to", " ", "be", " ", "changed", " ", "upon", " ", 
                  "extinction"}]}], " ", "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{"initialize", " ", "lists", " ", "of", " ", "data"}], 
                " ", "*)"}], "\[IndentingNewLine]", 
               RowBox[{"intersectionPoints", " ", "=", " ", 
                RowBox[{"{", "origin", "}"}]}], ";", "\[IndentingNewLine]", 
               RowBox[{"angleList", " ", "=", " ", 
                RowBox[{"{", "angle", "}"}]}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"moveLightRay", "[", 
                RowBox[{"intersectionPoints", ",", 
                 RowBox[{"Last", "[", "angleList", "]"}], ",", "atmosphere"}],
                 "]"}], ";", " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                "move", " ", "the", " ", "light", " ", "ray", " ", "up", " ", 
                 "to", " ", "the", " ", "first", " ", "atmosphere", " ", 
                 "encounter"}], " ", "*)"}], "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"extincted", " ", "=", " ", "False"}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "keep", " ", "on", " ", "moving", " ", "the", " ", "light", 
                 " ", "ray", " ", "forward", " ", "until", " ", "it", " ", 
                 "gets", " ", "all", " ", "the", " ", "way", " ", "through", 
                 " ", "the", " ", "atmosphere", " ", "or", " ", "is", " ", 
                 "completely", " ", "extincted"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"While", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"Norm", "[", 
                    RowBox[{"Last", "[", "intersectionPoints", "]"}], "]"}], "<=",
                    " ", "atmMax"}], " ", "&&", " ", 
                  RowBox[{"!", "extincted"}]}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"moveLightRay", "[", 
                   RowBox[{"intersectionPoints", ",", 
                    RowBox[{"Last", "[", "angleList", "]"}], ",", 
                    "atmosphere"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
                "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
               RowBox[{"(*", " ", 
                RowBox[{
                "put", " ", "the", " ", "results", " ", "in", " ", "the", " ",
                  "appropriate", " ", "lists"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"If", "[", 
                RowBox[{
                 RowBox[{"!", "extincted"}], ",", "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"startingPosition", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"-", "atmMax"}], "*", "1.25"}], ",", "yStart"}], 
                    "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"endingPosition", ",", 
                    RowBox[{"Last", "[", "intersectionPoints", "]"}]}], "]"}],
                   ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"totalRefraction", ",", 
                    RowBox[{"Last", "[", "angleList", "]"}]}], "]"}], ";", 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"finalFlux", ",", "currentRayFlux"}], "]"}], ";", 
                  " ", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                   "append", " ", "twice", " ", "for", " ", "top", " ", "and",
                     " ", "bottom", " ", "versions"}], " ", "*)"}], 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    "removes", " ", "the", " ", "last", " ", "intersection", 
                    " ", "point", " ", "because", " ", "that", " ", "one", 
                    " ", "will", " ", "be", " ", "at", " ", "the", " ", 
                    "observer", " ", "location"}], "..."}], " ", "far"}], ",",
                     " ", 
                    RowBox[{"far", " ", "away"}]}], " ", "*)"}], 
                  "\[IndentingNewLine]", 
                  RowBox[{"intersectionWithoutLast", " ", "=", " ", 
                   RowBox[{"intersectionPoints", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ";;", 
                    RowBox[{
                    RowBox[{"Length", "[", "intersectionPoints", "]"}], "-", 
                    "1"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"atmGraphics", ",", 
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"Graphics", "[", 
                    RowBox[{"{", 
                    RowBox[{"Red", ",", 
                    RowBox[{"PointSize", "[", "0.01", "]"}], ",", 
                    RowBox[{"Point", "[", "intersectionWithoutLast", "]"}]}], 
                    "}"}], "]"}], ",", 
                    RowBox[{
                    "ListLinePlot", "[", "intersectionWithoutLast", "]"}]}], 
                    "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
                  "\[IndentingNewLine]", 
                  RowBox[{"AppendTo", "[", 
                   RowBox[{"numIntersectionPoints", ",", 
                    RowBox[{"{", 
                    RowBox[{"yStart", ",", 
                    RowBox[{
                    RowBox[{"Length", "[", "intersectionPoints", "]"}], "-", 
                    "2"}]}], "}"}]}], "]"}], ";", " ", 
                  RowBox[{"(*", " ", 
                   RowBox[{
                   "minus", " ", "2", " ", "for", " ", "start", " ", "and", 
                    " ", "end", " ", "points"}], "*)"}], 
                  "\[IndentingNewLine]", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "startingPosition", "]"}], ">", 
                    "1"}], ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"AppendTo", "[", 
                    RowBox[{"d\[Theta]Overdy", ",", 
                    RowBox[{"{", 
                    RowBox[{"yStart", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"totalRefraction", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"totalRefraction", "[", 
                    RowBox[{"[", 
                    RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}], "/", " ", 
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"startingPosition", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "2"}], ",", "2"}], "]"}], "]"}], "-", 
                    RowBox[{"startingPosition", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "1"}], ",", "1"}], "]"}], "]"}]}], ")"}]}]}],
                     "}"}]}], "]"}], ";", "\[IndentingNewLine]", 
                    RowBox[{"beamsHittingAtm", " ", "=", " ", 
                    RowBox[{"beamsHittingAtm", " ", "+", " ", "1"}]}], 
                    ";"}]}], "\[IndentingNewLine]", "]"}]}], ",", 
                 "\[IndentingNewLine]", "\[IndentingNewLine]", 
                 RowBox[{"(*", " ", 
                  RowBox[{
                   RowBox[{
                   "if", " ", "the", " ", "light", " ", "was", " ", 
                    "extincted"}], ",", " ", 
                   RowBox[{
                   "skip", " ", "over", " ", "the", " ", "rest", " ", "of", 
                    " ", "the", " ", "beams", " ", "that", " ", "would", " ", 
                    "be"}], ",", " ", 
                   RowBox[{"assuming", " ", "symmetry"}]}], " ", "*)"}], 
                 "\[IndentingNewLine]", 
                 RowBox[{
                  RowBox[{"extinctionY", " ", "=", " ", "yStart"}], ";"}]}], 
                "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
               "\[IndentingNewLine]", 
               RowBox[{"NotebookDelete", "[", "yMultTemp", "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}]}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{
            "yMultFact", ",", "maxLightY", ",", "minLightY", ",", 
             "stepLightY"}], "}"}]}], "\[IndentingNewLine]", "]"}], " ", 
         "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<beams generated: \>\"", " ", "<>", " ", 
           RowBox[{"ToString", "[", "beamsGenerated", "]"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Print", "[", 
         RowBox[{"\"\<beams hitting the atmosphere: \>\"", " ", "<>", " ", 
          RowBox[{"ToString", "[", "beamsHittingAtm", "]"}]}], "]"}], ";"}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{
  3.6302615786212397`*^9, {3.630261673278514*^9, 3.6302616802474685`*^9}, {
   3.630261719155122*^9, 3.6302617367256374`*^9}, {3.6302621862907248`*^9, 
   3.6302621868521247`*^9}, {3.63026263796982*^9, 3.630262658207223*^9}, {
   3.6302694159678855`*^9, 3.630269432166398*^9}, {3.6302695489454155`*^9, 
   3.630269569100722*^9}, {3.6302696095044374`*^9, 3.630269623021068*^9}, {
   3.6302696711006064`*^9, 3.6302696901129155`*^9}, {3.6302697932273703`*^9, 
   3.630269796020336*^9}, 3.6303453106392317`*^9, {3.6304289165456285`*^9, 
   3.6304289236777134`*^9}, {3.630429009657633*^9, 3.6304290105082617`*^9}, {
   3.6304306686722*^9, 3.6304306932005816`*^9}, {3.6304307993408346`*^9, 
   3.6304308029693923`*^9}, 3.630431159915423*^9}]
}, Closed]],

Cell[CellGroupData[{

Cell["Lightcurve Generation Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6302630550652633`*^9, 3.6302630802361584`*^9}, {
  3.6302654256894054`*^9, 3.630265431569584*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "refraction", " ", "interpolation", " ", "on", " ", "shadow", " ", 
    "plane"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
     RowBox[{"TODO", " ", "-", " ", 
      RowBox[{
      "the", " ", "interpolation", " ", "orders", " ", "and", " ", "median", 
       " ", "filter", " ", "radii", " ", "are", " ", "fairly", " ", 
       "arbitrary", " ", "right", " ", "now"}]}], "..."}], " ", "resolve", 
    " ", 
    RowBox[{"somehow", "?"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"TODO", " ", "-", " ", 
    RowBox[{"eventually", " ", "make", " ", 
     RowBox[{"most", "/", "all"}], " ", "of", " ", "these", " ", "variables", 
     " ", "local"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"interpolateLC", "[", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"startSpacing", " ", "=", " ", 
         RowBox[{
          RowBox[{"startingPosition", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2"}], "]"}], "]"}], "-", 
          RowBox[{"startingPosition", "[", 
           RowBox[{"[", 
            RowBox[{"2", ",", "2"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"endSpacing", " ", "=", " ", 
         RowBox[{"Sort", "[", 
          RowBox[{
           RowBox[{"endingPosition", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", "Greater"}], 
          "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "get", " ", "and", " ", "sort", " ", "the", " ", "y", " ", "values", 
          " ", "of", " ", "the", " ", "ending", " ", "position", " ", 
          "array"}], " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"meanEndLocations", " ", "=", " ", 
         RowBox[{"Mean", "[", 
          RowBox[{"ArrayReshape", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"endSpacing", "[", 
               RowBox[{"[", 
                RowBox[{"1", ";;", 
                 RowBox[{
                  RowBox[{"Length", "[", "endSpacing", "]"}], "-", "1"}]}], 
                "]"}], "]"}], ",", 
              RowBox[{"endSpacing", "[", 
               RowBox[{"[", 
                RowBox[{"2", ";;"}], "]"}], "]"}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"2", ",", 
              RowBox[{
               RowBox[{"Length", "[", "endSpacing", "]"}], "-", "1"}]}], 
             "}"}]}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"density", " ", "interpolation", " ", "model"}], " ", "*)"}],
         "\[IndentingNewLine]", 
        RowBox[{"endSpacing", " ", "=", " ", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"endingPosition", "[", 
            RowBox[{"[", 
             RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", "1"}], "]"}]}], ";",
         " ", 
        RowBox[{"(*", " ", 
         RowBox[{
         "make", " ", "the", " ", "arrays", " ", "equal", " ", "length"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"endSpacing", " ", "=", " ", 
         RowBox[{"endSpacing", "-", 
          RowBox[{"endingPosition", "[", 
           RowBox[{"[", 
            RowBox[{
             RowBox[{"1", ";;", 
              RowBox[{
               RowBox[{"Length", "[", "endingPosition", "]"}], "-", "1"}]}], 
             ",", "2"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"endSpacingInterp", " ", "=", " ", 
         RowBox[{"Interpolation", "[", 
          RowBox[{"endSpacing", ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"beamDensity", " ", "=", " ", 
         RowBox[{"MedianFilter", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "startSpacing"}], "/", "endSpacing"}], ",", "3"}], 
          "]"}]}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"get", " ", "the", " ", "beam", " ", "density"}], " ", 
         "*)"}], "\[IndentingNewLine]", 
        RowBox[{"beamDensity", "=", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{"Riffle", "[", 
            RowBox[{"meanEndLocations", ",", "beamDensity"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "meanEndLocations", "]"}], ",", "2"}], 
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
        "\[IndentingNewLine]", 
        RowBox[{"beamDensity2", " ", "=", "beamDensity"}], ";", " ", 
        RowBox[{"(*", " ", 
         RowBox[{"for", " ", "the", " ", "other", " ", "limb"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"beamDensity2", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "=", 
         RowBox[{"-", 
          RowBox[{"beamDensity2", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "1"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"beamDensityInterp", " ", "=", " ", 
         RowBox[{"Interpolation", "[", 
          RowBox[{"beamDensity", ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], " ", 
        ";", 
        RowBox[{"(*", " ", 
         RowBox[{"linearly", " ", "interpolate", " ", "the", " ", "angle"}], 
         " ", "*)"}], "\[IndentingNewLine]", 
        RowBox[{"beamDensityInterp2", " ", "=", " ", 
         RowBox[{"Interpolation", "[", 
          RowBox[{"beamDensity2", ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"(*", " ", 
         RowBox[{"flux", " ", "interpolation", " ", "model"}], " ", "*)"}], 
        "\[IndentingNewLine]", 
        RowBox[{"beamMags", "=", "finalFlux"}], ";", "\[IndentingNewLine]", 
        RowBox[{"beamMags", "=", 
         RowBox[{"ArrayReshape", "[", 
          RowBox[{
           RowBox[{"Riffle", "[", 
            RowBox[{
             RowBox[{"endingPosition", "[", 
              RowBox[{"[", 
               RowBox[{";;", ",", "2"}], "]"}], "]"}], ",", "beamMags"}], 
            "]"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Length", "[", "finalFlux", "]"}], ",", "2"}], "}"}]}], 
          "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"beamMags2", "=", "beamMags"}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"beamMags2", "[", 
          RowBox[{"[", 
           RowBox[{";;", ",", "1"}], "]"}], "]"}], "=", 
         RowBox[{"-", 
          RowBox[{"beamMags2", "[", 
           RowBox[{"[", 
            RowBox[{";;", ",", "1"}], "]"}], "]"}]}]}], ";", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"magInterp", "=", 
         RowBox[{"Interpolation", "[", 
          RowBox[{"beamMags", ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"magInterp2", "=", 
         RowBox[{"Interpolation", "[", 
          RowBox[{"beamMags2", ",", 
           RowBox[{"InterpolationOrder", "\[Rule]", "1"}]}], "]"}]}], ";"}]}],
       "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "combine", " ", "the", " ", "two", " ", "limbs", " ", "generated", " ", 
     "by", " ", "the", " ", "interpolation"}], " ", "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "y", " ", "is", " ", "the", " ", "shadow", " ", "plane", " ", "y", " ", 
     "distance"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"twoLimbLC", "[", "y_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lcEquation", ",", "y1", ",", "y2", ",", "y3", ",", "y4"}], 
        "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"y1", ",", "y2", ",", "y3", ",", "y4"}], "}"}], "=", 
         RowBox[{"getBreakpoints", "[", 
          RowBox[{
          "magInterp", ",", "beamDensityInterp", ",", "magInterp2", ",", 
           "beamDensityInterp2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Which", "[", "\[IndentingNewLine]", 
         RowBox[{"(*", " ", 
          RowBox[{
          "how", " ", "the", " ", "equation", " ", "is", " ", "split", " ", 
           "up", " ", "depends", " ", "on", " ", "whether", " ", "or", " ", 
           "not", " ", "the", " ", "interpoltaion", " ", "domains", " ", 
           "overlap"}], " ", "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"y1", ">", "y4"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"lcEquation", " ", "=", " ", 
            RowBox[{"Piecewise", "[", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"magInterp2", "[", "y", "]"}], "*", 
                  RowBox[{"beamDensityInterp2", "[", "y", "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"y", "\[GreaterEqual]", " ", "y3"}], "&&", " ", 
                  RowBox[{"y", "\[LessEqual]", "y4"}]}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"magInterp2", "[", "y4", "]"}], "*", 
                  RowBox[{"beamDensityInterp2", "[", "y4", "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"y", ">", "y4"}], "&&", 
                  RowBox[{"y", "<", "y1"}]}]}], "}"}], ",", " ", 
               RowBox[{"(*", " ", 
                RowBox[{
                "artificial", " ", "connector", " ", "between", " ", "the", 
                 " ", "two", " ", "interpolations"}], " ", "*)"}], 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"magInterp", "[", "y", "]"}], "*", 
                  RowBox[{"beamDensityInterp", "[", "y", "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"y", "\[GreaterEqual]", "y1"}], "&&", 
                  RowBox[{"y", "\[LessEqual]", " ", "y2"}]}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"1", ",", "True"}], "}"}]}], "\[IndentingNewLine]", 
              "}"}], "]"}]}], ";"}], ",", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"y1", "\[LessEqual]", " ", "y4"}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"lcEquation", " ", "=", " ", 
            RowBox[{"Piecewise", "[", 
             RowBox[{"{", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"magInterp2", "[", "y", "]"}], "*", 
                  RowBox[{"beamDensityInterp2", "[", "y", "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"y", "\[GreaterEqual]", " ", "y3"}], "&&", 
                  RowBox[{"y", "\[LessEqual]", "y1"}]}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{
                   RowBox[{"magInterp", "[", "y", "]"}], "*", 
                   RowBox[{"beamDensityInterp", "[", "y", "]"}]}], "+", 
                  RowBox[{
                   RowBox[{"magInterp2", "[", "y", "]"}], "*", 
                   RowBox[{"beamDensityInterp2", "[", "y", "]"}]}]}], ",", 
                 RowBox[{
                  RowBox[{"y", ">", "y1"}], "&&", 
                  RowBox[{"y", "<", "y4"}]}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{
                  RowBox[{"magInterp", "[", "y", "]"}], "*", 
                  RowBox[{"beamDensityInterp", "[", "y", "]"}]}], ",", 
                 RowBox[{
                  RowBox[{"y", "\[GreaterEqual]", "y4"}], "&&", 
                  RowBox[{"y", "\[LessEqual]", " ", "y2"}]}]}], "}"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{"{", 
                RowBox[{"1", ",", "True"}], "}"}]}], "\[IndentingNewLine]", 
              "}"}], "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"Return", "[", "lcEquation", "]"}]}]}], "\[IndentingNewLine]",
       "]"}]}], ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->CompressedData["
1:eJxTTMoPSmViYGCQBGIQvYxJvkqX57Xjg0e3J4Non0mKs0C02/zns0G0xrni
cwZA2mK2xEUQ/dq1iiscpF73Gw+IVrLeLAiibfjPCINoFo/L5lFAOuBIqg+I
VpRiDQHRXia3EkH0rHL/dyB6Kp/iJxBddWMSczSQvrCsjh9Ev6sIlQPRPszb
wTSTyfOyCiA9yb26H0QvPu09GURfkkmbCqJ//n4wG0QvOBi0EEQf7GjeCKI3
rXPeC6JT/CQPgugl2xcdB9HfmK5cAtGOTx8+B9ET5c69B9F5z3q+gGj9rFl/
QfTVTe/AtMTjZs1KIC3y8ROYFk9SMAbRJ+w6rEH0T5H8kyD6sBPnaRB9LsKA
swpIs2+zA9NJvBxzQLRYrziYFhF45FwNol9wuINonlUHfED0ig3nwDQAvN+y
tQ==
  "]]
}, Closed]],

Cell[CellGroupData[{

Cell["Graphics Functions", "Subsection",
 InitializationCell->True,
 CellChangeTimes->{{3.6302601104067397`*^9, 3.6302601161207933`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"make", " ", "the", " ", "graphics", " ", "objects"}], " ", "*)"}],
   "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"TODO", " ", "-", " ", 
    RowBox[{
    "this", " ", "should", " ", "be", " ", "moved", " ", "to", " ", 
     "atmosphere", " ", "construction", " ", "after", " ", "the", " ", 
     RowBox[{
      RowBox[{"min", "/", "max"}], "/", "step"}], " ", "stuff", " ", "is", 
     " ", "resolved"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"makeAtmosphereGraphic", "[", "atm_", "]"}], ":=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Graphics", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Opacity", "[", "0.5", "]"}], ",", "Thin", ",", 
          RowBox[{"atm", "[", 
           RowBox[{"[", 
            RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "}"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "1", ",", 
         RowBox[{"Length", "[", "atm", "]"}]}], "}"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{
    "get", " ", "the", " ", "points", " ", "where", " ", "the", " ", "light", 
     " ", "ray", " ", "intersects", " ", "with", " ", "the", " ", 
     "atmosphere"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeIntersectionsPointsGraphic", "[", "intersections_", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Graphics", "[", 
         RowBox[{"{", 
          RowBox[{"Red", ",", 
           RowBox[{"Point", "[", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"x", "/.", 
                 RowBox[{"intersections", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], ",", 
                RowBox[{"y", "/.", 
                 RowBox[{"intersections", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", 
                RowBox[{"Length", "[", "intersections", "]"}]}], "}"}]}], 
             "]"}], "]"}]}], "}"}], "]"}], ";"}]}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"makeRayTraceGraphic", "[", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", "plutoGraphic", "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"plutoGraphic", "=", 
         RowBox[{"Graphics", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Darker", "[", 
             RowBox[{"Brown", ",", "0.7"}], "]"}], ",", 
            RowBox[{"Disk", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", "atmMin"}], "]"}]}], 
           "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Show", "[", 
         RowBox[{
          RowBox[{"makeAtmosphereGraphic", "[", "atmosphere", "]"}], ",", 
          "atmGraphics", ",", "plutoGraphic"}], "]"}]}]}], " ", 
      RowBox[{"(*", 
       RowBox[{"shell", " ", "graphic"}], "*)"}], "\[IndentingNewLine]", 
      "]"}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"makeLightCurveGraphic", "[", "]"}], ":=", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
        "equation", ",", "domainStart", ",", "domainEnd", ",", "y1", ",", 
         "y2", ",", "y3", ",", "y4"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{"y1", ",", "y2", ",", "y3", ",", "y4"}], "}"}], "=", 
         RowBox[{"getBreakpoints", "[", 
          RowBox[{
          "magInterp", ",", "beamDensityInterp", ",", "magInterp2", ",", 
           "beamDensityInterp2"}], "]"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"Plot", "[", 
         RowBox[{
          RowBox[{"twoLimbLC", "[", 
           RowBox[{"y", ",", "y1", ",", "y2", ",", "y3", ",", "y4"}], "]"}], 
          ",", 
          RowBox[{"{", 
           RowBox[{"y", ",", "y3", ",", "y2"}], "}"}], ",", 
          RowBox[{"Exclusions", "\[Rule]", "None"}], ",", 
          RowBox[{"AxesLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\<y distance (m)\>\"", ",", "\"\<flux\>\""}], 
            "}"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    ";"}]}]}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.6302591424828196`*^9, 3.6302591424848213`*^9}, {
   3.630259323636553*^9, 3.630259324094901*^9}, {3.6302596895205956`*^9, 
   3.630259726916173*^9}, 3.630260031104369*^9, {3.6302600658060637`*^9, 
   3.630260090706731*^9}, {3.6302604428290005`*^9, 3.6302604634406443`*^9}, {
   3.6302623932178955`*^9, 3.630262450608654*^9}, {3.6302625185849686`*^9, 
   3.6302625414812717`*^9}, 3.6302630306259203`*^9, {3.6302635384578223`*^9, 
   3.6302635581298065`*^9}, {3.630264312261789*^9, 3.6302643208269067`*^9}, {
   3.6302646988185587`*^9, 3.630264742769766*^9}, {3.6302698515728207`*^9, 
   3.630269860070861*^9}, {3.6302699102370777`*^9, 3.630269942271846*^9}, 
   3.63026998307883*^9, 3.6302700532727194`*^9, {3.6303567389925756`*^9, 
   3.6303567761812935`*^9}, {3.6303568163567715`*^9, 
   3.6303568711826177`*^9}, {3.63035692270817*^9, 3.6303569332746296`*^9}, {
   3.630356985682809*^9, 3.6303569943939605`*^9}, {3.6303570273373346`*^9, 
   3.630357032746168*^9}, {3.630357075505478*^9, 3.6303572671402845`*^9}, {
   3.630417853488904*^9, 3.6304178656124973`*^9}, {3.630417908235716*^9, 
   3.630418073474843*^9}, {3.6304183539376545`*^9, 3.6304183544660406`*^9}, {
   3.6304184302677484`*^9, 3.6304185522322*^9}, {3.630419129208173*^9, 
   3.630419136524378*^9}, 3.630420077443857*^9, 3.630421541850454*^9, 
   3.6304224115428905`*^9, {3.630422507425861*^9, 3.6304225407004414`*^9}, {
   3.630422589298896*^9, 3.6304225896791654`*^9}, {3.630422635115393*^9, 
   3.630422635529687*^9}}]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Temporary Functions (till we get the optical stuff resolved)", "Section",
 InitializationCell->True,
 InitializationGroup->True,
 CellChangeTimes->{{3.6302636219842186`*^9, 3.6302636389162235`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"elliotYoung92", "[", "r_", "]"}], ":=", 
    RowBox[{"SetPrecision", "[", 
     RowBox[{
      RowBox[{"1", "+", 
       RowBox[{"2", "*", 
        SuperscriptBox["10", "105"], 
        SuperscriptBox[
         RowBox[{"(", 
          RowBox[{"r", "-", 
           RowBox[{"1.3", "*", 
            SuperscriptBox["10", "5"]}]}], ")"}], 
         RowBox[{"-", "18.75"}]]}]}], ",", "100"}], "]"}]}], ";"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"TODO", " ", "-", " ", 
    RowBox[{
    "some", " ", "version", " ", "of", " ", "this", " ", "will", " ", "be", 
     " ", "in", " ", "the", " ", "final", " ", "atmosphere", " ", 
     "constructions", " ", "functins"}]}], " ", 
   "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"makeAtmosphereFromOpticalParams", "[", 
    RowBox[{"params_", ",", 
     RowBox[{"rArrayPos_:", "1"}], ",", 
     RowBox[{"\[ScriptCapitalN]ArrayPos_:", "8"}], ",", 
     RowBox[{"\[Alpha]zArrayPos_:", "6"}]}], "]"}], ":=", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "i", ",", "r", ",", "\[ScriptCapitalN]", ",", "\[Alpha]z", ",", 
       "paramAtmosphere"}], "}"}], ",", 
     RowBox[{"(*", 
      RowBox[{
      "override", " ", "the", " ", "global", " ", "atmosphere", " ", 
       "parameters", " ", "with", " ", "the", " ", "specified", " ", "ones"}],
       "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"layers", "=", 
       RowBox[{"Length", "[", "params", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"atmMin", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "rArrayPos"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"atmMax", "=", 
       RowBox[{"params", "[", 
        RowBox[{"[", 
         RowBox[{
          RowBox[{"Length", "[", "params", "]"}], ",", "rArrayPos"}], "]"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"atmStep", "=", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"atmMax", "-", "atmMin"}], ")"}], "/", "layers"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "create", " ", "the", " ", "proper", " ", "shells", " ", "and", " ", 
        "populate", " ", "the", " ", "atmosphere"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"paramAtmosphere", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"(*", 
          RowBox[{
          "TODO", " ", "adding", " ", "1", " ", "like", " ", "this", " ", 
           "might", " ", "cause", " ", "an", " ", "issue"}], "*)"}], 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"r", "=", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"params", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "rArrayPos"}], "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[ScriptCapitalN]", "=", 
           RowBox[{"SetPrecision", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"ToExpression", "[", 
               RowBox[{"params", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "\[ScriptCapitalN]ArrayPos"}], "]"}], 
                "]"}], "]"}], "+", "1"}], ",", "64"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"\[Alpha]z", "=", 
           RowBox[{"ToExpression", "[", 
            RowBox[{"params", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "\[Alpha]zArrayPos"}], "]"}], "]"}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"paramAtmosphere", "=", 
           RowBox[{"Append", "[", 
            RowBox[{"paramAtmosphere", ",", 
             RowBox[{"shell", "[", 
              RowBox[{"r", ",", "\[ScriptCapitalN]", ",", "\[Alpha]z"}], 
              "]"}]}], "]"}]}], ";"}], "}"}], ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"i", ",", "1", ",", "layers"}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "paramAtmosphere", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.630263839331665*^9, 3.6302638566189494`*^9}, {
   3.63026564966061*^9, 3.630265676683793*^9}, {3.6302688590400295`*^9, 
   3.630268867658154*^9}, 3.6302694756412973`*^9, 3.63026952324514*^9, 
   3.6302700064774604`*^9, {3.630336540898241*^9, 3.630336582041405*^9}, {
   3.630337012370429*^9, 3.630337138713992*^9}, {3.6303372897530527`*^9, 
   3.6303372916514006`*^9}, {3.6303435280682*^9, 3.630343544928144*^9}, 
   3.6303437027901154`*^9, {3.6303462983553963`*^9, 3.630346298706647*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["Testing", "Section",
 CellChangeTimes->{{3.6302589939252205`*^9, 3.6302589956004615`*^9}, {
  3.6302637089650097`*^9, 3.630263711667983*^9}}],

Cell[CellGroupData[{

Cell["Atmosphere Construction", "Subsection",
 CellChangeTimes->{{3.6302637150593386`*^9, 3.6302637189671245`*^9}, {
  3.6303477921565976`*^9, 3.630347793844851*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"r0", "=", "rPluto"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"r1", "=", 
   RowBox[{"r0", "+", 
    RowBox[{"(", 
     RowBox[{"500", "*", "1000"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"r2", "=", 
   RowBox[{"r1", "+", 
    RowBox[{"(", 
     RowBox[{"500", "*", "1000"}], ")"}]}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"radii", "=", 
   RowBox[{"{", 
    RowBox[{"r0", ",", "r1", ",", "r2"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"MPlanet", "=", "MPluto"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"sectionShells", "=", 
   RowBox[{"{", 
    RowBox[{"10", ",", "20"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"boundaryT", "=", 
   RowBox[{"{", 
    RowBox[{"50", ",", "60", ",", "60"}], "}"}]}], ";"}], "\n", 
 RowBox[{
  RowBox[{"boundaryM", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"MN2", ",", 
     RowBox[{"Length", "[", "radii", "]"}]}], "]"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{"constant", " ", "composition"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"P0", "=", "0.3"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"boundary\[Alpha]z", "=", 
   RowBox[{"{", 
    RowBox[{"0.0000001", ",", "0", ",", "0"}], "}"}]}], ";", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{
    "only", " ", "haze", " ", "at", " ", "the", " ", "bottom", " ", "layer"}],
     "-", 
    RowBox[{
    "TODO", " ", "using", " ", "arbitrary", " ", "number", " ", "for", " ", 
     "now"}]}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"boundary\[Alpha]", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"\[Alpha]N2", ",", 
     RowBox[{"Length", "[", "radii", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
   "exportFolderPath", "=", 
    "\"\</Users/Hosea/Dropbox (MIT)//Academic/12.ThG/TestAtmospheres\>\""}], 
   ";"}], "\n"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"params", "=", 
    RowBox[{"{", 
     RowBox[{
     "radii", ",", "boundaryT", ",", "boundaryM", ",", "sectionShells", ",", 
      "P0", ",", "boundary\[Alpha]z", ",", "boundary\[Alpha]", ",", 
      "MPluto"}], "}"}]}], ";"}], "\n", 
  RowBox[{"(*", 
   RowBox[{"makeAtmosphereSet", "[", 
    RowBox[{"params", ",", "exportFolderPath", ",", 
     RowBox[{"{", 
      RowBox[{"\"\<T\>\"", ",", "2", ",", "40", ",", "55", ",", "1"}], "}"}], 
     ",", "1"}], "]"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{"(*", " ", 
   RowBox[{"TODO", " ", "-", " ", 
    RowBox[{
    "put", " ", "some", " ", "way", " ", "to", " ", "track", " ", "progress", 
     " ", "here"}]}], " ", "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"makeAtmosphere", "[", 
   RowBox[{"params", ",", "exportFolderPath", ",", "1"}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"plotAtmosphereProperties", "[", 
     RowBox[{
     "exportFolderPath", "<>", "\"\</constructedAtmosphere1.tsv\>\""}], "]"}],
     "[", 
    RowBox[{"[", "7", "]"}], "]"}], "*)"}]}]}], "Input",
 CellChangeTimes->{{3.630258997661871*^9, 3.630258997663901*^9}, {
   3.630259543843059*^9, 3.6302595442513475`*^9}, {3.630264961494446*^9, 
   3.630264985804755*^9}, {3.6302664821492634`*^9, 3.630266488775992*^9}, {
   3.630266708571624*^9, 3.630266717479955*^9}, {3.6302674086772113`*^9, 
   3.6302674348398104`*^9}, {3.6302681035380774`*^9, 
   3.6302681061789465`*^9}, {3.6302685556253996`*^9, 3.630268668108336*^9}, 
   3.6302692774934373`*^9, 3.630269356354517*^9, {3.6303438466632895`*^9, 
   3.630343907603484*^9}, {3.6303472842025723`*^9, 3.6303472921341944`*^9}, {
   3.6303473609849696`*^9, 3.630347363966101*^9}, {3.630347442927082*^9, 
   3.6303474766920147`*^9}, {3.6303475185686703`*^9, 
   3.6303475351924543`*^9}, {3.630347574255142*^9, 3.6303475940461693`*^9}, {
   3.630347672156538*^9, 3.6303476842961407`*^9}, {3.6304204870682135`*^9, 
   3.630420509672236*^9}, {3.6304205408583345`*^9, 3.630420589058529*^9}, {
   3.630420635153181*^9, 3.6304206476190157`*^9}, {3.6304215888847637`*^9, 
   3.6304215932908936`*^9}, {3.630427343105325*^9, 3.630427362589135*^9}, {
   3.630427439247478*^9, 3.630427447239167*^9}, {3.630427496630149*^9, 
   3.63042760694034*^9}, 3.630427706247732*^9, {3.6304309321459837`*^9, 
   3.630430935286186*^9}, {3.630431275113089*^9, 3.630431277212577*^9}, {
   3.6304316712498713`*^9, 3.6304316724026794`*^9}, {3.6304320163144484`*^9, 
   3.6304320341000743`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Lightcurve Generation", "Subsection",
 CellChangeTimes->{{3.630263745129713*^9, 3.630263748450103*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"atmosphere", " ", "=", " ", 
   RowBox[{"makeAtmosphereFromOpticalParams", "[", 
    RowBox[{
     RowBox[{"Import", "[", 
      RowBox[{
      "\"\<C:\\\\Users\\\\Hosea\\\\Dropbox \
(MIT)\\\\Academic\\\\12.ThG\\\\TestAtmospheres\\\\constructedAtmosphere1.TSV\>\
\"", ",", 
       RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", " ", "1"}]}], "]"}], ",", 
     "1", ",", "8", ",", "6"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"atmosphere", " ", "=", " ", 
     RowBox[{"makeAtmosphereFromOpticalParams", "[", 
      RowBox[{
       RowBox[{
       "Import", "[", 
        "\"\<C:\\\\Users\\\\Hosea\\\\Dropbox \
(MIT)\\\\Academic\\\\12.ThG\\\\AtmosphereCode\\\\sampledAtmWithEYExtinction.\
TSV\>\"", "]"}], ",", "1", ",", "2", ",", "3"}], "]"}]}], ";"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.630263750589621*^9, 3.6302638012726192`*^9}, {
   3.63026388251337*^9, 3.630263898004382*^9}, {3.6302639868034773`*^9, 
   3.6302639883756156`*^9}, {3.630264272168294*^9, 3.6302642760330706`*^9}, {
   3.6302643439332995`*^9, 3.6302643470875416`*^9}, {3.630264636192047*^9, 
   3.6302646369665976`*^9}, {3.6302647754479904`*^9, 3.6302647758483047`*^9}, 
   3.6302699433716097`*^9, {3.6302699839104404`*^9, 3.6302700074001155`*^9}, 
   3.630270055432255*^9, {3.630336443783239*^9, 3.630336508152023*^9}, {
   3.630336597948681*^9, 3.630336646093829*^9}, {3.63034304106942*^9, 
   3.6303430540896564`*^9}, {3.6303431179889517`*^9, 
   3.6303431207859344`*^9}, {3.63034316896134*^9, 3.630343194366325*^9}, 
   3.630344616778315*^9, {3.6303446856201143`*^9, 3.630344703837023*^9}, {
   3.630344816729127*^9, 3.630344869962866*^9}, {3.6303449235688677`*^9, 
   3.6303450666742983`*^9}, {3.630345179899555*^9, 3.630345181068413*^9}, 
   3.6303460165147142`*^9, 3.6303463090990133`*^9, {3.630346877690895*^9, 
   3.630346889094496*^9}, {3.6303469243855224`*^9, 3.630346926407956*^9}, {
   3.6303470435129337`*^9, 3.630347083069974*^9}, {3.630347138644371*^9, 
   3.630347140459655*^9}, {3.6303471858178062`*^9, 3.6303471875370235`*^9}, {
   3.6303473231731844`*^9, 3.6303473257230043`*^9}, {3.630347606483013*^9, 
   3.630347606838251*^9}, {3.63034764806349*^9, 3.6303476482515945`*^9}, {
   3.630347823188141*^9, 3.6303478249373918`*^9}, {3.6303552477252035`*^9, 
   3.630355266616577*^9}, {3.6304187938584747`*^9, 3.6304188113879004`*^9}, {
   3.6304196242901793`*^9, 3.6304196251437817`*^9}, {3.6304204633103733`*^9, 
   3.630420472232698*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "\"\<ray tracing...\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rayTrace", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<done ray tracing\>\"", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.630263750589621*^9, 3.6302638012726192`*^9}, {
   3.63026388251337*^9, 3.630263898004382*^9}, {3.6302639868034773`*^9, 
   3.6302639883756156`*^9}, {3.630264272168294*^9, 3.6302642760330706`*^9}, {
   3.6302643439332995`*^9, 3.6302643470875416`*^9}, {3.630264636192047*^9, 
   3.6302646369665976`*^9}, {3.6302647754479904`*^9, 3.6302647758483047`*^9}, 
   3.6302699433716097`*^9, {3.6302699839104404`*^9, 3.6302700074001155`*^9}, 
   3.630270055432255*^9, {3.630336443783239*^9, 3.630336508152023*^9}, {
   3.630336597948681*^9, 3.630336646093829*^9}, {3.63034304106942*^9, 
   3.6303430540896564`*^9}, {3.6303431179889517`*^9, 
   3.6303431207859344`*^9}, {3.63034316896134*^9, 3.630343194366325*^9}, 
   3.630344616778315*^9, {3.6303446856201143`*^9, 3.630344703837023*^9}, {
   3.630344816729127*^9, 3.630344869962866*^9}, {3.6303449235688677`*^9, 
   3.6303450666742983`*^9}, {3.630345179899555*^9, 3.630345181068413*^9}, 
   3.6303460165147142`*^9, 3.6303463090990133`*^9, {3.630346877690895*^9, 
   3.630346889094496*^9}, {3.6303469243855224`*^9, 3.630346926407956*^9}, {
   3.6303470435129337`*^9, 3.630347083069974*^9}, {3.630347138644371*^9, 
   3.630347140459655*^9}, {3.6303471858178062`*^9, 3.6303471875370235`*^9}, {
   3.6303473231731844`*^9, 3.6303473257230043`*^9}, {3.630347606483013*^9, 
   3.630347606838251*^9}, {3.63034764806349*^9, 3.6303476482515945`*^9}, {
   3.630347823188141*^9, 3.6303478249373918`*^9}, {3.6303552477252035`*^9, 
   3.6303552815541644`*^9}, {3.630418771605709*^9, 3.630418773624131*^9}, {
   3.630428933455616*^9, 3.6304289358503137`*^9}, {3.6304320423448973`*^9, 
   3.630432045168907*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "\"\<making ray trace graphic...\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"makeRayTraceGraphic", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<done making ray trace graphic\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.630263750589621*^9, 3.6302638012726192`*^9}, {
   3.63026388251337*^9, 3.630263898004382*^9}, {3.6302639868034773`*^9, 
   3.6302639883756156`*^9}, {3.630264272168294*^9, 3.6302642760330706`*^9}, {
   3.6302643439332995`*^9, 3.6302643470875416`*^9}, {3.630264636192047*^9, 
   3.6302646369665976`*^9}, {3.6302647754479904`*^9, 3.6302647758483047`*^9}, 
   3.6302699433716097`*^9, {3.6302699839104404`*^9, 3.6302700074001155`*^9}, 
   3.630270055432255*^9, {3.630336443783239*^9, 3.630336508152023*^9}, {
   3.630336597948681*^9, 3.630336646093829*^9}, {3.63034304106942*^9, 
   3.6303430540896564`*^9}, {3.6303431179889517`*^9, 
   3.6303431207859344`*^9}, {3.63034316896134*^9, 3.630343194366325*^9}, 
   3.630344616778315*^9, {3.6303446856201143`*^9, 3.630344703837023*^9}, {
   3.630344816729127*^9, 3.630344869962866*^9}, {3.6303449235688677`*^9, 
   3.6303450666742983`*^9}, {3.630345179899555*^9, 3.630345181068413*^9}, 
   3.6303460165147142`*^9, 3.6303463090990133`*^9, {3.630346877690895*^9, 
   3.630346889094496*^9}, {3.6303469243855224`*^9, 3.630346926407956*^9}, {
   3.6303470435129337`*^9, 3.630347083069974*^9}, {3.630347138644371*^9, 
   3.630347140459655*^9}, {3.6303471858178062`*^9, 3.6303471875370235`*^9}, {
   3.6303473231731844`*^9, 3.6303473257230043`*^9}, {3.630347606483013*^9, 
   3.630347606838251*^9}, {3.63034764806349*^9, 3.6303476482515945`*^9}, {
   3.630347823188141*^9, 3.6303478249373918`*^9}, {3.6303552477252035`*^9, 
   3.6303552815541644`*^9}, {3.630418771605709*^9, 3.630418773624131*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "\"\<interpolating lightcurve...\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"interpolateLC", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Print", "[", "\"\<done interpolating lightcurve\>\"", "]"}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.630263750589621*^9, 3.6302638012726192`*^9}, {
   3.63026388251337*^9, 3.630263898004382*^9}, {3.6302639868034773`*^9, 
   3.6302639883756156`*^9}, {3.630264272168294*^9, 3.6302642760330706`*^9}, {
   3.6302643439332995`*^9, 3.6302643470875416`*^9}, {3.630264636192047*^9, 
   3.6302646369665976`*^9}, {3.6302647754479904`*^9, 3.6302647758483047`*^9}, 
   3.6302699433716097`*^9, {3.6302699839104404`*^9, 3.6302700074001155`*^9}, 
   3.630270055432255*^9, {3.630336443783239*^9, 3.630336508152023*^9}, {
   3.630336597948681*^9, 3.630336646093829*^9}, {3.63034304106942*^9, 
   3.6303430540896564`*^9}, {3.6303431179889517`*^9, 
   3.6303431207859344`*^9}, {3.63034316896134*^9, 3.630343194366325*^9}, 
   3.630344616778315*^9, {3.6303446856201143`*^9, 3.630344703837023*^9}, {
   3.630344816729127*^9, 3.630344869962866*^9}, {3.6303449235688677`*^9, 
   3.6303450666742983`*^9}, {3.630345179899555*^9, 3.630345181068413*^9}, 
   3.6303460165147142`*^9, 3.6303463090990133`*^9, {3.630346877690895*^9, 
   3.630346889094496*^9}, {3.6303469243855224`*^9, 3.630346926407956*^9}, {
   3.6303470435129337`*^9, 3.630347083069974*^9}, {3.630347138644371*^9, 
   3.630347140459655*^9}, {3.6303471858178062`*^9, 3.6303471875370235`*^9}, {
   3.6303473231731844`*^9, 3.6303473257230043`*^9}, {3.630347606483013*^9, 
   3.630347606838251*^9}, {3.63034764806349*^9, 3.6303476482515945`*^9}, {
   3.630347823188141*^9, 3.6303478249373918`*^9}, {3.6303552477252035`*^9, 
   3.630355287279228*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Print", "[", "\"\<making lightcurve graphic...\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"makeLightCurveGraphic", "[", "]"}], "\[IndentingNewLine]", 
 RowBox[{"Print", "[", "\"\<done\>\"", "]"}]}], "Input",
 CellChangeTimes->{{3.630263750589621*^9, 3.6302638012726192`*^9}, {
   3.63026388251337*^9, 3.630263898004382*^9}, {3.6302639868034773`*^9, 
   3.6302639883756156`*^9}, {3.630264272168294*^9, 3.6302642760330706`*^9}, {
   3.6302643439332995`*^9, 3.6302643470875416`*^9}, {3.630264636192047*^9, 
   3.6302646369665976`*^9}, {3.6302647754479904`*^9, 3.6302647758483047`*^9}, 
   3.6302699433716097`*^9, {3.6302699839104404`*^9, 3.6302700074001155`*^9}, 
   3.630270055432255*^9, {3.630336443783239*^9, 3.630336508152023*^9}, {
   3.630336597948681*^9, 3.630336646093829*^9}, {3.63034304106942*^9, 
   3.6303430540896564`*^9}, {3.6303431179889517`*^9, 
   3.6303431207859344`*^9}, {3.63034316896134*^9, 3.630343194366325*^9}, 
   3.630344616778315*^9, {3.6303446856201143`*^9, 3.630344703837023*^9}, {
   3.630344816729127*^9, 3.630344869962866*^9}, {3.6303449235688677`*^9, 
   3.6303450666742983`*^9}, {3.630345179899555*^9, 3.630345181068413*^9}, 
   3.6303460165147142`*^9, 3.6303463090990133`*^9, {3.630346877690895*^9, 
   3.630346889094496*^9}, {3.6303469243855224`*^9, 3.630346926407956*^9}, {
   3.6303470435129337`*^9, 3.630347083069974*^9}, {3.630347138644371*^9, 
   3.630347140459655*^9}, {3.6303471858178062`*^9, 3.6303471875370235`*^9}, {
   3.6303473231731844`*^9, 3.6303473257230043`*^9}, {3.630347606483013*^9, 
   3.630347606838251*^9}, {3.63034764806349*^9, 3.6303476482515945`*^9}, {
   3.630347823188141*^9, 3.6303478249373918`*^9}, {3.6303552477252035`*^9, 
   3.630355287279228*^9}, {3.6303570473415146`*^9, 3.630357047955929*^9}, {
   3.630418132478661*^9, 3.6304181377293897`*^9}, 3.630418564035568*^9, 
   3.6304187619678907`*^9, {3.6304199085366607`*^9, 3.630419909719505*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Code for Least Squares Fitting", "Section",
 CellChangeTimes->{{3.630421990948766*^9, 3.630422030849043*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"(*", " ", 
   RowBox[{"called", " ", "per", " ", "model"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"modelNumber", " ", "=", " ", "1"}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
    "this", " ", "number", " ", "will", " ", "change", " ", "with", " ", 
     "each", " ", "fit"}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"c", " ", "=", " ", "1"}], ";", " ", 
   RowBox[{"(*", " ", 
    RowBox[{
     RowBox[{
     "this", " ", "is", " ", "the", " ", "number", " ", "of", " ", "the", " ",
       "x"}], "-", 
     RowBox[{
     "axis", " ", "point", " ", "that", " ", "is", " ", "moving", " ", 
      "across", " ", "the", " ", "model", " ", "to", " ", "sample", " ", 
      "it"}]}], " ", "*)"}], "\[IndentingNewLine]", 
   RowBox[{"makeAtmosphereFromOpticalParams", "[", 
    RowBox[{"params", ",", "exportFolderPath", ",", "modelNumber"}], "]"}], 
   ";", "\[IndentingNewLine]", 
   RowBox[{"atmosphere", " ", "=", " ", 
    RowBox[{"makeAtmosphereFromOpticalParams", "[", 
     RowBox[{
      RowBox[{"Import", "[", 
       RowBox[{
        RowBox[{
        "\"\<C:\\\\Users\\\\Hosea\\\\Dropbox \
(MIT)\\\\Academic\\\\12.ThG\\\\TestAtmospheres\\\\constructedAtmosphere\>\"", 
         "<>", 
         RowBox[{"IntegerString", "[", "modelNumber", "]"}], "<>", 
         "\"\<1.TSV\>\""}], ",", 
        RowBox[{"\"\<HeaderLines\>\"", "\[Rule]", " ", "1"}]}], "]"}], ",", 
      "1", ",", "8", ",", "6"}], "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"rayTrace", "[", "]"}], ";", "\[IndentingNewLine]", 
   RowBox[{"interpolateLC", "[", "]"}], ";", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", " ", 
    RowBox[{"called", " ", "per", " ", "coordinate", " ", "point"}], " ", 
    "*)"}], "\[IndentingNewLine]", 
   RowBox[{"twoLimbLC", "[", "c", "]"}], ";"}], "\[IndentingNewLine]", 
  "*)"}]], "Input",
 CellChangeTimes->{{3.6304220542996793`*^9, 3.630422176986657*^9}, {
  3.6304222220115504`*^9, 3.630422233951008*^9}, {3.6304226611197987`*^9, 
  3.6304226875915637`*^9}, {3.630422718776674*^9, 3.6304227272356625`*^9}, {
  3.6304228076957026`*^9, 3.6304228473397965`*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1600, 817},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"10.0 for Microsoft Windows (64-bit) (December 4, 2014)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 175, 4, 139, "Title"],
Cell[CellGroupData[{
Cell[780, 30, 261, 5, 70, "Section",
 InitializationCell->True,
 InitializationGroup->True],
Cell[1044, 37, 796, 21, 66, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[1877, 63, 168, 3, 56, "Section",
 InitializationCell->True,
 InitializationGroup->True],
Cell[2048, 68, 2353, 65, 166, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[4438, 138, 226, 4, 56, "Section",
 InitializationCell->True,
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[4689, 146, 135, 2, 49, "Subsection",
 InitializationCell->True],
Cell[4827, 150, 3084, 82, 216, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[7948, 237, 135, 2, 41, "Subsection",
 InitializationCell->True],
Cell[8086, 241, 14579, 337, 1351, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[22702, 583, 150, 2, 41, "Subsection",
 InitializationCell->True],
Cell[22855, 587, 19039, 433, 1546, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[41931, 1025, 137, 2, 41, "Subsection",
 InitializationCell->True],
Cell[42071, 1029, 10270, 247, 406, "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[52390, 1282, 260, 5, 70, "Section",
 InitializationCell->True,
 InitializationGroup->True],
Cell[CellGroupData[{
Cell[52675, 1291, 133, 2, 49, "Subsection",
 InitializationCell->True],
Cell[52811, 1295, 1728, 43, 132, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[54576, 1343, 161, 3, 41, "Subsection",
 InitializationCell->True],
Cell[54740, 1348, 14445, 348, 1317, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[69222, 1701, 138, 2, 41, "Subsection",
 InitializationCell->True],
Cell[69363, 1705, 52201, 1111, 4958, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[121601, 2821, 201, 3, 41, "Subsection",
 InitializationCell->True],
Cell[121805, 2826, 13413, 311, 1186, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[135255, 3142, 137, 2, 41, "Subsection",
 InitializationCell->True],
Cell[135395, 3146, 6125, 138, 386, "Input",
 InitializationCell->True]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[141569, 3290, 204, 3, 70, "Section",
 InitializationCell->True,
 InitializationGroup->True],
Cell[141776, 3295, 4823, 117, 430, "Input",
 InitializationCell->True]
}, Closed]],
Cell[CellGroupData[{
Cell[146636, 3417, 147, 2, 56, "Section"],
Cell[CellGroupData[{
Cell[146808, 3423, 166, 2, 49, "Subsection"],
Cell[146977, 3427, 4337, 107, 386, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[151351, 3539, 109, 1, 49, "Subsection"],
Cell[151463, 3542, 2523, 46, 66, "Input"],
Cell[153989, 3590, 1935, 30, 86, "Input"],
Cell[155927, 3622, 1853, 28, 86, "Input"],
Cell[157783, 3652, 1799, 28, 86, "Input"],
Cell[159585, 3682, 1960, 28, 86, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[161594, 3716, 115, 1, 70, "Section"],
Cell[161712, 3719, 2178, 48, 266, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

(* End of internal cache information *)
